<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é‡œå±±èŠ±ç«ä¹‹æ—…</title>
    
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            var errorBox = document.getElementById('error-box');
            if (errorBox) {
                errorBox.style.display = 'block';
                document.getElementById('error-msg').innerText = "ç™¼ç”ŸéŒ¯èª¤ï¼š\n" + msg + "\nLine: " + lineNo;
            }
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼ (åŸç”ŸCSSï¼Œä¸ä¾è³´ Tailwind) */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            background-attachment: fixed;
            color: #334155;
            min-height: 100vh;
        }
        
        /* æ­¡è¿é å¼·åˆ¶æ¨£å¼ (ç¢ºä¿ä¸€å®šçœ‹å¾—åˆ°) */
        #welcome-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #4c1d95; /* é è¨­æ·±ç´«ï¼Œé¿å…åœ–ç‰‡æ²’å‡ºä¾†æ™‚å…¨ç™½ */
            background-size: cover; background-position: center;
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 50px;
            cursor: pointer;
        }

        /* éŒ¯èª¤è¨Šæ¯æ¡† */
        #error-box {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); color: #ff5555; z-index: 10000;
            padding: 20px; font-family: monospace; white-space: pre-wrap;
        }

        /* Vue ç›¸é—œæ¨£å¼ */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-top: 1px solid rgba(255,255,255,0.5); }
        .header-gradient { background: linear-gradient(135deg, rgba(139, 92, 246, 0.9) 0%, rgba(236, 72, 153, 0.9) 100%); }
        .tab-active { background-color: #9333ea !important; color: white !important; }
        .tab-inactive { background-color: #f1f5f9; color: #64748b; }
        
        /* å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

    <div id="error-box">
        <h2 style="color:white; font-size:20px;">âš ï¸ ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤</h2>
        <p id="error-msg"></p>
        <button onclick="localStorage.clear(); location.reload();" style="margin-top:20px; padding:10px; background:white; color:black; border:none;">æ¸…é™¤è³‡æ–™ä¸¦é‡æ•´ (Fix)</button>
    </div>

    <div id="app">
        <div id="welcome-layer" v-show="showWelcomePage" @click="enterApp" 
             :style="{ backgroundImage: `url('./welcome.jpg')` }">
             
             <div class="animate-bounce bg-white/20 backdrop-blur-md border border-white/40 px-6 py-2 rounded-full text-white text-sm tracking-widest shadow-lg">
                âœ¨ é»æ“Šè¢å¹•é–‹å§‹æ—…ç¨‹ âœ¨
             </div>
        </div>

        <div v-show="!showWelcomePage" class="min-h-screen pb-28">
            
            <header class="header-gradient text-white pt-14 pb-12 px-6 rounded-b-[2.5rem] relative overflow-hidden mb-[-2rem] shadow-lg">
                <button @click="backToWelcome" class="absolute top-6 left-6 z-20 text-white p-2 bg-white/20 rounded-full backdrop-blur-md">
                    <i class="ri-arrow-left-s-line text-xl"></i>
                </button>

                <div class="relative z-10 text-center">
                    <div class="flex justify-center items-center gap-2 mb-2 opacity-90">
                        <p class="text-xs tracking-[0.2em] uppercase font-bold">Busan 2026</p>
                        <button @click="editDate" class="text-xs border border-white/40 px-2.5 py-1 rounded-full"><i class="ri-settings-3-line"></i> è¨­å®šæ—¥æœŸ</button>
                    </div>
                    <h1 class="text-3xl font-bold mb-6 tracking-wide drop-shadow-md">é‡œå±±èŠ±ç«ç¯€<br>æ…¢æ´»å¥¢è¯æ—…</h1>
                    
                    <div class="inline-flex items-center justify-center gap-6 py-3 px-8 bg-white/20 backdrop-blur-md rounded-full border border-white/30">
                        <div class="text-center">
                            <span class="block text-2xl font-bold font-mono text-yellow-200">{{ daysLeft }}</span>
                            <span class="text-[10px] uppercase">Days</span>
                        </div>
                        <div class="h-8 w-px bg-white/40"></div>
                        <div class="text-center">
                            <span class="block text-2xl font-bold font-mono text-pink-200">{{ hoursLeft }}</span>
                            <span class="text-[10px] uppercase">Hrs</span>
                        </div>
                    </div>
                </div>
            </header>

            <div v-if="currentTab === 'home'" class="px-5 pt-12 relative z-20">
                <div class="bg-white/80 backdrop-blur p-6 rounded-3xl shadow-sm mb-4">
                    <h3 class="font-bold text-lg text-slate-700 mb-3 flex items-center gap-2"><i class="ri-list-check text-purple-500"></i> è¡Œå‰æº–å‚™</h3>
                    <div class="space-y-3">
                        <div v-for="(item, idx) in prepList" :key="idx" @click="item.done = !item.done" class="flex items-center justify-between p-2 hover:bg-purple-50 rounded-lg cursor-pointer">
                            <div class="flex items-center gap-3">
                                <i :class="item.done ? 'ri-checkbox-circle-fill text-green-500' : 'ri-checkbox-blank-circle-line text-gray-300'" class="text-xl"></i>
                                <span :class="item.done ? 'line-through text-gray-400' : 'text-slate-700'">{{ item.text }}</span>
                            </div>
                            <button @click.stop="deletePrep(idx)" class="text-gray-300 hover:text-red-500"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4 pt-3 border-t border-gray-100">
                        <input v-model="newPrepItem" placeholder="æ–°å¢å¾…è¾¦..." class="flex-1 bg-gray-50 border-none rounded-lg px-3 py-2 text-sm outline-none">
                        <button @click="addPrep" class="bg-purple-500 text-white px-3 rounded-lg"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'schedule'" class="px-4 pt-12">
                <div class="flex overflow-x-auto space-x-3 pb-4 px-1">
                    <button v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                        :class="`flex-shrink-0 px-5 py-2 rounded-2xl text-sm font-bold shadow-sm transition-all ${activeDayIndex === index ? 'bg-purple-600 text-white' : 'bg-white text-slate-500'}`">
                        Day {{ day.day }}
                    </button>
                </div>
                <div class="bg-white/90 rounded-3xl p-6 min-h-[50vh] shadow-sm">
                    <div class="flex justify-between items-end mb-6 border-b border-gray-100 pb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">Day {{ itinerary[activeDayIndex].day }}</h2>
                            <p class="text-sm text-purple-500 font-bold mt-1">{{ itinerary[activeDayIndex].date }}</p>
                        </div>
                        <button @click="editDayTitle" class="text-xs bg-gray-100 px-3 py-1 rounded text-gray-500">{{ itinerary[activeDayIndex].title }} <i class="ri-edit-line"></i></button>
                    </div>
                    <div class="space-y-6 border-l-2 border-gray-100 ml-2 pl-6 relative">
                        <div v-for="(event, idx) in itinerary[activeDayIndex].events" :key="idx" class="relative group">
                            <div :class="`absolute -left-[33px] top-1 w-4 h-4 rounded-full border-2 border-white shadow ${event.isImportant ? 'bg-pink-500' : 'bg-indigo-400'}`"></div>
                            <div>
                                <div class="flex justify-between items-start">
                                    <span class="text-xs font-mono font-bold text-slate-400 bg-gray-50 px-2 py-0.5 rounded mb-1 inline-block">{{ event.time }}</span>
                                    <div class="flex gap-1">
                                        <button v-if="idx > 0" @click="moveEvent(activeDayIndex, idx, -1)" class="text-gray-400 hover:text-purple-600"><i class="ri-arrow-up-s-line"></i></button>
                                        <button v-if="idx < itinerary[activeDayIndex].events.length - 1" @click="moveEvent(activeDayIndex, idx, 1)" class="text-gray-400 hover:text-purple-600"><i class="ri-arrow-down-s-line"></i></button>
                                        <button @click="deleteEvent(activeDayIndex, idx)" class="text-gray-300 hover:text-red-500 ml-1"><i class="ri-close-line"></i></button>
                                    </div>
                                </div>
                                <h4 class="font-bold text-slate-800 text-lg">{{ event.title }}</h4>
                                <p class="text-sm text-slate-500 leading-relaxed mb-2">{{ event.desc }}</p>
                                <button v-if="event.mapQuery" @click="openMap(event.mapQuery)" class="bg-green-500 text-white text-xs px-2 py-1 rounded hover:bg-green-600"><i class="ri-map-pin-2-fill"></i> Naver Map</button>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-xl mt-4">
                            <div class="grid grid-cols-4 gap-2 mb-2">
                                <input v-model="newEvent.time" placeholder="æ™‚é–“" class="col-span-1 p-2 rounded border-none text-sm">
                                <input v-model="newEvent.title" placeholder="æ¨™é¡Œ" class="col-span-3 p-2 rounded border-none text-sm">
                            </div>
                            <input v-model="newEvent.desc" placeholder="å‚™è¨»" class="w-full p-2 rounded border-none text-sm mb-2">
                            <button @click="addEvent" class="w-full bg-purple-600 text-white py-2 rounded-lg text-sm font-bold">åŠ å…¥è¡Œç¨‹</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="px-5 pt-12 space-y-6">
                <div class="bg-white/90 rounded-3xl p-5 shadow-sm">
                    <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="ri-hotel-fill text-purple-500"></i> ä½å®¿è³‡è¨Š</h2>
                    <div class="space-y-4">
                        <div v-for="(hotel, idx) in infoList" :key="idx" class="bg-white border border-gray-100 p-4 rounded-2xl relative">
                            <button @click="deleteInfo(idx)" class="absolute top-2 right-2 text-gray-300 hover:text-red-500"><i class="ri-delete-bin-line"></i></button>
                            <h3 class="font-bold text-slate-800">{{ hotel.name }}</h3>
                            <p class="text-sm text-slate-500">{{ hotel.desc }}</p>
                            <div class="mt-2 flex gap-2">
                                <button @click="openMap(hotel.name)" class="flex-1 bg-gray-50 py-1.5 rounded text-xs font-bold text-slate-600">å°èˆª</button>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-xl flex gap-2">
                            <input v-model="newInfo.name" placeholder="åç¨±" class="flex-1 p-2 rounded text-sm border-none">
                            <button @click="addInfo" class="bg-purple-600 text-white px-3 rounded-lg">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="px-5 pt-12 pb-24 space-y-6">
                <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-xl">
                    <p class="text-xs text-slate-400 mb-1">ç¸½æ”¯å‡º (TWD)</p>
                    <h2 class="text-4xl font-bold font-mono">${{ Math.round(currentTotal * 0.024).toLocaleString() }}</h2>
                    <p class="text-sm text-slate-500 mt-2">â‰ˆ â‚©{{ currentTotal.toLocaleString() }}</p>
                </div>
                
                <div class="bg-white/90 rounded-3xl p-5 shadow-sm">
                    <div class="flex gap-2 mb-4 bg-gray-100 p-1 rounded-xl">
                        <button @click="activeBudgetTab = 'public'" :class="`flex-1 py-2 rounded-lg text-xs font-bold ${activeBudgetTab === 'public' ? 'tab-active' : 'tab-inactive'}`">ğŸ’° å…¬å¸³</button>
                        <button @click="activeBudgetTab = 'me'" :class="`flex-1 py-2 rounded-lg text-xs font-bold ${activeBudgetTab === 'me' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¤ æˆ‘</button>
                        <button @click="activeBudgetTab = 'partner'" :class="`flex-1 py-2 rounded-lg text-xs font-bold ${activeBudgetTab === 'partner' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¥ æ—…ä¼´</button>
                    </div>
                    
                    <div v-if="activeBudgetTab === 'public'" class="mb-4 bg-purple-50 text-purple-800 p-2 rounded-lg text-center text-sm font-bold">æ¯äººæ‡‰ä»˜: â‚©{{ Math.round(currentTotal / 2).toLocaleString() }}</div>

                    <div class="flex gap-2 mb-4">
                        <input v-model="newItemName" placeholder="å“é …" class="flex-1 p-2 bg-gray-50 rounded text-sm">
                        <input v-model="newItemPrice" type="number" placeholder="â‚©" class="w-24 p-2 bg-gray-50 rounded text-sm">
                        <button @click="addItem" class="bg-purple-600 text-white w-10 rounded-lg"><i class="ri-add-line"></i></button>
                    </div>

                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        <div v-for="(item, idx) in currentBudgetList" :key="idx" class="flex justify-between p-3 bg-gray-50 rounded-xl text-sm">
                            <span>{{ item.name }}</span>
                            <div class="flex items-center gap-2">
                                <span class="font-mono">â‚©{{ item.price }}</span>
                                <button @click="deleteItem(idx)" class="text-gray-300 hover:text-red-500"><i class="ri-close-circle-fill"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white/90 rounded-3xl p-5 shadow-sm">
                    <h3 class="text-sm font-bold mb-3"><i class="ri-arrow-left-right-line"></i> è³‡æ–™åŒæ­¥</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="exportData" class="bg-blue-50 text-blue-600 py-2 rounded-xl text-sm font-bold">ğŸ“¤ åŒ¯å‡ºä»£ç¢¼</button>
                        <button @click="importData" class="bg-green-50 text-green-600 py-2 rounded-xl text-sm font-bold">ğŸ“¥ åŒ¯å…¥ä»£ç¢¼</button>
                    </div>
                    <div class="mt-4 text-center">
                        <button @click="resetData" class="text-xs text-red-400 underline">é‡ç½®æ‰€æœ‰è³‡æ–™</button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'checklist'" class="px-5 pt-12 space-y-4">
                <div class="flex gap-2 mb-4 bg-white/50 p-1 rounded-xl">
                    <button @click="activeChecklistTab = 'me'" :class="`flex-1 py-2 rounded-lg text-xs font-bold ${activeChecklistTab === 'me' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¤ æˆ‘çš„è¡Œæ</button>
                    <button @click="activeChecklistTab = 'partner'" :class="`flex-1 py-2 rounded-lg text-xs font-bold ${activeChecklistTab === 'partner' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¥ æ—…ä¼´è¡Œæ</button>
                </div>
                <div class="bg-white/90 rounded-3xl overflow-hidden p-2">
                    <div v-for="(item, idx) in currentChecklist" :key="idx" @click="toggleCheck(idx)" class="flex items-center p-3 border-b border-gray-100 cursor-pointer">
                        <i :class="item.done ? 'ri-checkbox-circle-fill text-purple-500' : 'ri-checkbox-blank-circle-line text-gray-300'" class="text-xl mr-3"></i>
                        <span :class="item.done ? 'line-through text-gray-400' : 'text-slate-700'">{{ item.text }}</span>
                    </div>
                </div>
            </div>

        </div>

        <nav v-show="!showWelcomePage" class="fixed bottom-0 left-0 right-0 glass-nav z-50 pb-safe shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <div class="grid grid-cols-5 items-end h-16 max-w-md mx-auto relative">
                <button @click="currentTab = 'schedule'" :class="`flex flex-col items-center justify-center h-full pb-1 ${currentTab === 'schedule' ? 'text-purple-600' : 'text-slate-400'}`">
                    <i class="text-xl mb-1 ri-calendar-event-fill"></i><span class="text-[10px] font-bold">è¡Œç¨‹</span>
                </button>
                <button @click="currentTab = 'info'" :class="`flex flex-col items-center justify-center h-full pb-1 ${currentTab === 'info' ? 'text-purple-600' : 'text-slate-400'}`">
                    <i class="text-xl mb-1 ri-hotel-fill"></i><span class="text-[10px] font-bold">è³‡è¨Š</span>
                </button>
                <div class="relative flex justify-center h-full">
                    <button @click="currentTab = 'home'" class="absolute -top-6 w-14 h-14 rounded-full bg-gradient-to-tr from-purple-600 to-pink-500 text-white flex items-center justify-center shadow-lg shadow-purple-200 transform hover:scale-105 transition-transform">
                        <i class="ri-home-4-fill text-2xl"></i>
                    </button>
                    <span :class="`absolute bottom-1 text-[10px] font-bold ${currentTab === 'home' ? 'text-purple-600' : 'text-slate-400'}`">é¦–é </span>
                </div>
                <button @click="currentTab = 'budget'" :class="`flex flex-col items-center justify-center h-full pb-1 ${currentTab === 'budget' ? 'text-purple-600' : 'text-slate-400'}`">
                    <i class="text-xl mb-1 ri-wallet-3-fill"></i><span class="text-[10px] font-bold">è¨˜å¸³</span>
                </button>
                <button @click="currentTab = 'checklist'" :class="`flex flex-col items-center justify-center h-full pb-1 ${currentTab === 'checklist' ? 'text-purple-600' : 'text-slate-400'}`">
                    <i class="text-xl mb-1 ri-checkbox-multiple-fill"></i><span class="text-[10px] font-bold">æ¸…å–®</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const showWelcomePage = ref(true);
                const currentTab = ref('home');
                const activeDayIndex = ref(0);
                const activeBudgetTab = ref('public');
                const activeChecklistTab = ref('me');
                
                // æ ¸å¿ƒè³‡æ–™åˆå§‹åŒ–
                const defaultDate = "2026-11-13T14:30:00";
                const targetDate = ref(defaultDate);
                const daysLeft = ref(0);
                const hoursLeft = ref(0);
                
                // é è¨­è³‡æ–™
                const prepList = ref([{text:'æ©Ÿç¥¨',done:false}, {text:'ä½å®¿',done:false}, {text:'è† å›Šåˆ—è»Š',done:false}, {text:'Kakao T',done:false}]);
                const newPrepItem = ref('');
                const infoList = ref([{name:'Hotel 1', desc:'å»£å®‰é‡Œæµ·æ™¯', tag:'Day 1-2'}, {name:'Arban Hotel', desc:'è¥¿é¢', tag:'Day 3-4'}]);
                const newInfo = ref({name:'', desc:'', tag:''});
                
                const itinerary = ref([
                    {day:1, date:"11/13(äº”)", title:"æŠµé”", events:[{time:"14:30", title:"æ©Ÿå ´", desc:"é ˜WOWPASS", mapQuery:"Gimhae Airport"}]},
                    {day:2, date:"11/14(å…­)", title:"ç…™ç«", events:[{time:"11:00", title:"è† å›Šåˆ—è»Š", desc:"å°¾æµ¦å‡ºç™¼", mapQuery:"Mipo Station"}, {time:"20:00", title:"é‡œå±±ç…™ç«ç¯€", desc:"æˆ¿å…§çœ‹", mapQuery:"Gwangalli"}]},
                    {day:3, date:"11/15(æ—¥)", title:"æ…¶å·", events:[{time:"11:00", title:"æ…¶å·åŒ…è»Š", desc:"çš‡ç†åœ˜è·¯/å¤§é™µè‹‘", mapQuery:"Gyeongju"}]},
                    {day:4, date:"11/16(ä¸€)", title:"ç”˜å·", events:[{time:"11:00", title:"ç”˜å·æ´", desc:"å°ç‹å­", mapQuery:"Gamcheon"}, {time:"15:00", title:"å—æµ¦æ´", desc:"æ¨‚å¤©è¶…å¸‚", mapQuery:"Lotte Mart"}]},
                    {day:5, date:"11/17(äºŒ)", title:"è¿”ç¨‹", events:[{time:"11:00", title:"æ©Ÿå ´å…ç¨…", desc:"è£œè²¨", mapQuery:"Gimhae Airport"}]}
                ]);
                const newEvent = ref({time:'', title:'', desc:'', mapQuery:''});

                const publicExpenses = ref([]);
                const myExpenses = ref([]);
                const partnerExpenses = ref([]);
                const newItemName = ref('');
                const newItemPrice = ref('');

                const myPackingList = ref([{text:'è­·ç…§',done:false}, {text:'è½‰æ¥é ­',done:false}, {text:'ç‰™åˆ·',done:false}]);
                const partnerPackingList = ref([{text:'è­·ç…§',done:false}, {text:'è½‰æ¥é ­',done:false}, {text:'ç‰™åˆ·',done:false}]);

                // --- å­˜å–é‚è¼¯ (ä½¿ç”¨æ–° Key: busan_v10_fresh) ---
                const saveData = () => {
                    const data = {
                        targetDate: targetDate.value, prepList: prepList.value, infoList: infoList.value,
                        itinerary: itinerary.value, publicExpenses: publicExpenses.value,
                        myExpenses: myExpenses.value, partnerExpenses: partnerExpenses.value,
                        myPackingList: myPackingList.value, partnerPackingList: partnerPackingList.value
                    };
                    localStorage.setItem('busan_v10_fresh', JSON.stringify(data));
                };

                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('busan_v10_fresh');
                        if (saved) {
                            const data = JSON.parse(saved);
                            if(data.targetDate) targetDate.value = data.targetDate;
                            if(data.prepList) prepList.value = data.prepList;
                            if(data.infoList) infoList.value = data.infoList;
                            if(data.itinerary) itinerary.value = data.itinerary;
                            if(data.publicExpenses) publicExpenses.value = data.publicExpenses;
                            if(data.myExpenses) myExpenses.value = data.myExpenses;
                            if(data.partnerExpenses) partnerExpenses.value = data.partnerExpenses;
                            if(data.myPackingList) myPackingList.value = data.myPackingList;
                            if(data.partnerPackingList) partnerPackingList.value = data.partnerPackingList;
                        }
                    } catch(e) {
                        console.log("è³‡æ–™è®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼");
                    }
                };

                // Watcher
                watch([targetDate, prepList, infoList, itinerary, publicExpenses, myExpenses, partnerExpenses, myPackingList, partnerPackingList], saveData, { deep: true });

                // åŠŸèƒ½
                const calculateCountdown = () => {
                    const now = new Date().getTime(); const target = new Date(targetDate.value).getTime(); const diff = target - now;
                    if(diff>0) { daysLeft.value = Math.floor(diff/(1000*60*60*24)); hoursLeft.value = Math.floor((diff%(1000*60*60*24))/(1000*60*60)); }
                };
                const editDate = () => { const d = prompt("æ—¥æœŸ (YYYY-MM-DD)", targetDate.value.split('T')[0]); if(d) targetDate.value = d+"T14:30:00"; calculateCountdown(); };
                
                const enterApp = () => showWelcomePage.value = false;
                const backToWelcome = () => showWelcomePage.value = true;
                const openMap = (q) => window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(q)}`, '_blank');

                // CRUD Helper
                const addPrep = () => { if(newPrepItem.value) { prepList.value.push({text:newPrepItem.value, done:false}); newPrepItem.value=''; }};
                const deletePrep = (i) => prepList.value.splice(i,1);
                const addInfo = () => { if(newInfo.value.name) { infoList.value.push({...newInfo.value}); newInfo.value={name:'',desc:'',tag:''}; }};
                const deleteInfo = (i) => infoList.value.splice(i,1);
                
                const editDayTitle = () => { const t = prompt("ä¿®æ”¹æ¨™é¡Œ", itinerary.value[activeDayIndex.value].title); if(t) itinerary.value[activeDayIndex.value].title=t; };
                const addEvent = () => { if(newEvent.value.title) { itinerary.value[activeDayIndex.value].events.push({...newEvent.value}); newEvent.value={time:'',title:'',desc:'',mapQuery:''}; }};
                const deleteEvent = (di, ei) => itinerary.value[di].events.splice(ei,1);
                const moveEvent = (di, ei, dir) => {
                    const list = itinerary.value[di].events; const ni = ei + dir;
                    if(ni >= 0 && ni < list.length) [list[ei], list[ni]] = [list[ni], list[ei]];
                };

                const currentBudgetList = computed(() => activeBudgetTab.value === 'public' ? publicExpenses.value : (activeBudgetTab.value === 'me' ? myExpenses.value : partnerExpenses.value));
                const currentTotal = computed(() => currentBudgetList.value.reduce((s,i) => s + Number(i.price), 0));
                const addItem = () => { if(newItemName.value && newItemPrice.value) { currentBudgetList.value.push({name:newItemName.value, price:newItemPrice.value}); newItemName.value=''; newItemPrice.value=''; }};
                const deleteItem = (i) => currentBudgetList.value.splice(i,1);

                const currentChecklist = computed(() => activeChecklistTab.value === 'me' ? myPackingList.value : partnerPackingList.value);
                const toggleCheck = (i) => { const l = activeChecklistTab.value === 'me' ? myPackingList.value : partnerPackingList.value; l[i].done = !l[i].done; };

                // Import/Export/Reset
                const exportData = () => { const d = JSON.stringify(localStorage.getItem('busan_v10_fresh')); navigator.clipboard.writeText(d).then(()=>alert("ä»£ç¢¼å·²è¤‡è£½ï¼")); };
                const importData = () => { 
                    const t = prompt("è²¼ä¸Šä»£ç¢¼ï¼š"); 
                    if(t) { 
                        try { localStorage.setItem('busan_v10_fresh', JSON.parse(t)); location.reload(); } 
                        catch(e) { alert("ä»£ç¢¼éŒ¯èª¤"); } 
                    } 
                };
                const resetData = () => { if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.removeItem('busan_v10_fresh'); location.reload(); } };

                onMounted(() => {
                    loadData();
                    calculateCountdown();
                    setInterval(calculateCountdown, 60000);
                });

                return {
                    showWelcomePage, enterApp, backToWelcome, currentTab, daysLeft, hoursLeft, editDate, openMap,
                    prepList, addPrep, deletePrep, newPrepItem,
                    activeDayIndex, itinerary, editDayTitle, addEvent, deleteEvent, moveEvent, newEvent,
                    infoList, addInfo, deleteInfo, newInfo,
                    activeBudgetTab, newItemName, newItemPrice, currentBudgetList, currentTotal, addItem, deleteItem,
                    activeChecklistTab, currentChecklist, toggleCheck,
                    exportData, importData, resetData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
