<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é‡œå±±Â·æ…¶å· å¿«æ¨‚ä¹‹æ—…</title>
    
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            var errorBox = document.getElementById('error-box');
            if (errorBox) {
                errorBox.style.display = 'block';
                document.getElementById('error-msg').innerText = "éŒ¯èª¤ï¼š\n" + msg;
            }
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; padding: 0;
            background: #f8fafc;
            color: #334155;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* æ­¡è¿é  */
        #welcome-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px;
        }

        /* éŒ¯èª¤æ¡† */
        #error-box {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); color: #ff5555; z-index: 10000; padding: 20px;
        }

        /* UI å…ƒä»¶ */
        .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 80px); }
        .glass-nav { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(12px); 
            border-top: 1px solid rgba(0,0,0,0.05); 
        }
        .header-gradient { 
            background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%); 
            /* é‡œå±±æµ·é¢¨é…è‰² */
        }
        
        /* å¡ç‰‡æ¨£å¼ */
        .card { background: white; border-radius: 1.5rem; padding: 1.25rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .btn-primary { background: #3b82f6; color: white; border-radius: 0.75rem; padding: 0.5rem 1rem; font-weight: bold; }
        
        /* å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

    <div id="error-box">
        <h2 class="text-white text-xl font-bold mb-2">âš ï¸ ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤</h2>
        <p id="error-msg" class="font-mono text-sm"></p>
        <button onclick="localStorage.clear(); location.reload();" class="mt-4 px-4 py-2 bg-white text-black rounded">æ¸…é™¤è³‡æ–™ä¸¦é‡æ•´</button>
    </div>

    <div id="app" class="min-h-screen">
        
        <div id="welcome-layer" v-if="showWelcomePage">
            <div class="text-white text-center mb-10">
                <h1 class="text-4xl font-bold mb-2 tracking-widest">BUSAN 2026</h1>
                <p class="text-blue-100 text-sm tracking-widest">HAPPY TRIP WITH DUCK & WEN</p>
            </div>
            
            <button @click="enterApp" class="bg-white text-indigo-600 px-8 py-3 rounded-full font-bold shadow-lg text-lg mb-6 w-64 hover:scale-105 transition-transform">
                é–‹å§‹æ—…ç¨‹
            </button>

            <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl w-full max-w-sm border border-white/20">
                <h3 class="text-white text-sm font-bold mb-3 flex items-center gap-2"><i class="ri-download-cloud-2-line"></i> åŒ¯å…¥è¡Œç¨‹ä»£ç¢¼</h3>
                <div class="flex gap-2">
                    <input v-model="importCode" placeholder="è²¼ä¸Šä»£ç¢¼..." class="flex-1 bg-white/20 border-none rounded-lg px-3 py-2 text-sm text-white placeholder-blue-200 outline-none">
                    <button @click="processImport" class="bg-blue-400 text-white px-3 rounded-lg text-sm font-bold">åŒ¯å…¥</button>
                </div>
                <p class="text-xs text-blue-200 mt-2">*è‹¥æœ‰æœ‹å‹åˆ†äº«çš„è¡Œç¨‹ä»£ç¢¼ï¼Œè«‹è²¼ä¸Šä¸¦åŒ¯å…¥</p>
            </div>
        </div>

        <div v-else class="pb-safe">
            
            <header class="header-gradient pt-12 pb-8 px-6 rounded-b-[2.5rem] shadow-sm relative z-10">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-slate-600 text-xs font-bold tracking-wider mb-1">2026.11.13 - 11.17</p>
                        <h1 class="text-2xl font-bold text-slate-800">é‡œå±±æ…¶å·<br>æ…¢æ´»ä¹‹æ—… ğŸ‡°ğŸ‡·</h1>
                    </div>
                    <button @click="exportData" class="bg-white/40 backdrop-blur p-2 rounded-full text-slate-700 hover:bg-white transition-colors">
                        <i class="ri-save-3-line text-xl"></i>
                    </button>
                </div>

                <div class="mt-6 flex gap-3">
                    <div class="bg-white/60 backdrop-blur px-4 py-2 rounded-2xl flex-1 flex flex-col items-center">
                        <span class="text-2xl font-bold text-blue-600 font-mono">{{ daysLeft }}</span>
                        <span class="text-[10px] text-slate-500 uppercase font-bold">Days Left</span>
                    </div>
                    <div class="bg-white/60 backdrop-blur px-4 py-2 rounded-2xl flex-1 flex flex-col items-center">
                        <span class="text-xl font-bold text-slate-700 font-mono">{{ weather.temp }}Â°C</span>
                        <span class="text-[10px] text-slate-500 uppercase font-bold">{{ weather.desc }}</span>
                    </div>
                </div>
            </header>

            <div v-if="currentTab === 'home'" class="px-5 pt-6 space-y-6">
                <div class="card bg-blue-50 border border-blue-100">
                    <h3 class="font-bold text-slate-700 mb-2 flex items-center gap-2"><i class="ri-t-shirt-2-line text-blue-500"></i> ç©¿æ­å»ºè­°</h3>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        11æœˆä¸­æ—¬é‡œå±±æ°£æº«ç´„ 8-16Â°Cã€‚æ—©æ™šæº«å·®å¤§ï¼Œæµ·é‚Šé¢¨å¤§ã€‚
                        <br><span class="text-blue-600 font-bold">å»ºè­°ï¼š</span>æ´‹è”¥å¼ç©¿æ³• (ç™¼ç†±è¡£+è–„é•·è¢–+é˜²é¢¨å¤§è¡£/åšé‡ç¹”)ã€‚å¸¶ä¸€æ¢åœå·¾å¾ˆå¥½ç”¨ï¼
                    </p>
                </div>

                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-700 text-lg"><i class="ri-checkbox-line text-purple-500"></i> å¾…è¾¦æ¸…å–®</h3>
                        <span class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full font-bold">{{ prepList.filter(i=>!i.done).length }} å¾…å®Œæˆ</span>
                    </div>
                    <div class="space-y-3">
                        <div v-for="(item, idx) in prepList" :key="idx" @click="item.done = !item.done" class="flex items-center justify-between p-2 hover:bg-slate-50 rounded-lg cursor-pointer transition-colors">
                            <div class="flex items-center gap-3">
                                <div :class="`w-5 h-5 rounded border flex items-center justify-center ${item.done ? 'bg-purple-500 border-purple-500' : 'border-gray-300'}`">
                                    <i v-if="item.done" class="ri-check-line text-white text-xs"></i>
                                </div>
                                <span :class="item.done ? 'line-through text-gray-400' : 'text-slate-700'">{{ item.text }}</span>
                            </div>
                            <button @click.stop="deletePrep(idx)" class="text-gray-300 hover:text-red-500"><i class="ri-close-line"></i></button>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4 pt-3 border-t border-gray-100">
                        <input v-model="newPrepItem" placeholder="æ–°å¢å¾…è¾¦ (å¦‚: è²·ç¶²å¡)" class="flex-1 bg-gray-50 border-none rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-purple-200">
                        <button @click="addPrep" class="bg-purple-500 text-white px-3 rounded-lg"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'schedule'" class="px-4 pt-4">
                <div class="flex overflow-x-auto space-x-3 pb-4 hide-scrollbar">
                    <button v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                        :class="`flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold shadow-sm transition-all whitespace-nowrap ${activeDayIndex === index ? 'bg-blue-600 text-white' : 'bg-white text-slate-500'}`">
                        Day {{ day.day }}
                    </button>
                </div>
                
                <div class="bg-white rounded-[2rem] p-6 shadow-sm min-h-[50vh]">
                    <div class="flex justify-between items-baseline mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">Day {{ itinerary[activeDayIndex].day }}</h2>
                        <span class="text-sm font-bold text-blue-500 bg-blue-50 px-3 py-1 rounded-full">{{ itinerary[activeDayIndex].date }}</span>
                    </div>

                    <div v-if="itinerary[activeDayIndex].title.includes('æ…¶å·')" class="mb-6 bg-pink-50 border border-pink-100 p-3 rounded-xl flex gap-3 items-start">
                        <i class="ri-star-smile-fill text-pink-500 mt-1"></i>
                        <div class="text-sm text-pink-800">
                            <strong>éŸ“æœæ¨è–¦ï¼š</strong> æ…¶å·å¤§é™µè‹‘é™„è¿‘ã€‚é€™è£¡æœ‰éŸ“å±‹ç‰†ã€å¤å¢³å…¬åœ’ï¼Œæ‹ç…§æ¯”ç¾ä»£åŒ–çš„é‡œå±±æ›´æœ‰ç©¿è¶Šæ„Ÿï¼æ¨è–¦ã€ŒDorandoranã€æˆ–çš‡ç†åœ˜è·¯ä¸Šçš„åº—å®¶ã€‚
                        </div>
                    </div>

                    <div class="space-y-8 relative pl-4 border-l-2 border-slate-100 ml-2">
                        <div v-for="(event, idx) in itinerary[activeDayIndex].events" :key="idx" class="relative group">
                            <div class="absolute -left-[21px] top-1.5 w-3 h-3 rounded-full border-2 border-white shadow bg-blue-400"></div>
                            
                            <div class="pl-4">
                                <span class="text-xs font-mono font-bold text-slate-400 mb-1 block">{{ event.time }}</span>
                                <h4 class="font-bold text-slate-800 text-lg mb-1">{{ event.title }}</h4>
                                <p class="text-sm text-slate-500 leading-relaxed mb-2">{{ event.desc }}</p>
                                <div class="flex gap-2">
                                    <button v-if="event.mapQuery" @click="openMap(event.mapQuery)" class="bg-green-100 text-green-700 text-xs px-2.5 py-1 rounded-md font-bold hover:bg-green-200 transition-colors">
                                        <i class="ri-map-pin-2-fill"></i> Naver Map
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'joy'" class="px-5 pt-4 pb-20">
                <div class="bg-white p-4 rounded-3xl shadow-sm mb-6 sticky top-4 z-20">
                    <h2 class="font-bold text-xl text-slate-800 mb-3 text-center">âœ¨ å¿«æ¨‚åœ°åœ–</h2>
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button v-for="cat in joyCategories" :key="cat.id" @click="activeJoyCat = cat.id"
                            :class="`px-3 py-1.5 rounded-full text-xs font-bold transition-colors ${activeJoyCat === cat.id ? 'bg-yellow-400 text-black shadow-md' : 'bg-gray-100 text-gray-500'}`">
                            {{ cat.name }}
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <div v-for="shop in joyData[activeJoyCat]" :key="shop.name" class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-50">
                        <div>
                            <h3 class="font-bold text-slate-800">{{ shop.name }}</h3>
                            <p class="text-xs text-slate-500 mt-1">{{ shop.desc }}</p>
                            <span v-if="shop.must" class="inline-block mt-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded font-bold">å¿…å»</span>
                        </div>
                        <button @click="openMap(shop.query)" class="w-10 h-10 bg-green-50 rounded-full flex items-center justify-center text-green-600 hover:bg-green-100">
                            <i class="ri-direction-fill text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="px-5 pt-6 space-y-6 pb-24">
                <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                    <i class="ri-money-cny-circle-line absolute -bottom-4 -right-4 text-9xl text-white/5 rotate-12"></i>
                    
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <div>
                            <p class="text-xs text-slate-400">ç¸½æ”¯å‡º (TWD)</p>
                            <h2 class="text-4xl font-bold font-mono my-1">${{ Math.round(currentTotal * exchangeRate).toLocaleString() }}</h2>
                            <p class="text-sm text-slate-500">â‰ˆ â‚©{{ currentTotal.toLocaleString() }}</p>
                        </div>
                        <div class="text-right">
                            <label class="text-[10px] text-slate-400 block mb-1">å³æ™‚åŒ¯ç‡</label>
                            <input type="number" step="0.001" v-model="exchangeRate" class="w-16 bg-slate-700 text-white text-center rounded border border-slate-600 text-sm py-1 font-mono">
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-3xl p-5 shadow-sm">
                    <div class="flex gap-2 mb-4 bg-gray-100 p-1 rounded-xl">
                        <button @click="activeBudgetTab = 'public'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${activeBudgetTab === 'public' ? 'bg-slate-700 text-white shadow' : 'text-gray-500'}`">
                            å…¬å¸³
                        </button>
                        <button @click="activeBudgetTab = 'user1'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all flex justify-center items-center gap-1 ${activeBudgetTab === 'user1' ? 'bg-slate-700 text-white shadow' : 'text-gray-500'}`">
                            <i class="ri-user-smile-line"></i> {{ user1Name }}
                        </button>
                        <button @click="activeBudgetTab = 'user2'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all flex justify-center items-center gap-1 ${activeBudgetTab === 'user2' ? 'bg-slate-700 text-white shadow' : 'text-gray-500'}`">
                            <i class="ri-user-heart-line"></i> {{ user2Name }}
                        </button>
                    </div>

                    <div v-if="activeBudgetTab !== 'public'" class="mb-4 flex items-center justify-end gap-2">
                        <span class="text-xs text-gray-400">ä¿®æ”¹æš±ç¨±:</span>
                        <input v-if="activeBudgetTab === 'user1'" v-model="user1Name" class="bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs w-20">
                        <input v-if="activeBudgetTab === 'user2'" v-model="user2Name" class="bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs w-20">
                    </div>

                    <div v-if="activeBudgetTab === 'public'" class="mb-4 bg-purple-50 text-purple-800 p-3 rounded-lg text-center text-sm font-bold flex justify-between items-center px-6">
                        <span>æ¯äººæ‡‰ä»˜:</span>
                        <span class="font-mono text-lg">â‚©{{ Math.round(currentTotal / 2).toLocaleString() }}</span>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input v-model="newItemName" placeholder="å“é … (å¦‚: çƒ¤è…¸)" class="flex-1 p-2.5 bg-gray-50 rounded-xl text-sm border-none outline-none">
                        <input v-model="newItemPrice" type="number" placeholder="â‚©" class="w-24 p-2.5 bg-gray-50 rounded-xl text-sm border-none outline-none font-mono">
                        <button @click="addItem" class="bg-slate-700 text-white w-10 rounded-xl flex items-center justify-center"><i class="ri-add-line"></i></button>
                    </div>

                    <div class="space-y-2 max-h-64 overflow-y-auto pr-1">
                        <div v-for="(item, idx) in currentBudgetList" :key="idx" class="flex justify-between p-3 border-b border-gray-50 last:border-0 text-sm items-center">
                            <span class="text-slate-700">{{ item.name }}</span>
                            <div class="flex items-center gap-3">
                                <span class="font-mono text-slate-500">â‚©{{ parseInt(item.price).toLocaleString() }}</span>
                                <button @click="deleteItem(idx)" class="text-gray-300 hover:text-red-500"><i class="ri-close-circle-fill"></i></button>
                            </div>
                        </div>
                        <div v-if="currentBudgetList.length === 0" class="text-center text-gray-300 text-xs py-4">å°šç„¡ç´€éŒ„</div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="px-5 pt-6 space-y-6 pb-24">
                
                <div class="grid grid-cols-3 gap-3">
                    <a href="tel:112" class="bg-red-50 p-3 rounded-2xl flex flex-col items-center text-red-600">
                        <i class="ri-alarm-warning-fill text-2xl mb-1"></i>
                        <span class="text-xs font-bold">è­¦å¯Ÿ 112</span>
                    </a>
                    <a href="tel:119" class="bg-red-50 p-3 rounded-2xl flex flex-col items-center text-red-600">
                        <i class="ri-fire-fill text-2xl mb-1"></i>
                        <span class="text-xs font-bold">ç«è­¦ 119</span>
                    </a>
                    <a href="https://overseas.mofa.go.kr/kr-busan-zh/index.do" target="_blank" class="bg-blue-50 p-3 rounded-2xl flex flex-col items-center text-blue-600">
                        <i class="ri-government-fill text-2xl mb-1"></i>
                        <span class="text-xs font-bold">è¾¦äº‹è™•</span>
                    </a>
                </div>

                <div class="card">
                    <h3 class="font-bold text-slate-800 mb-3"><i class="ri-translate-2" class="text-blue-500"></i> å¿…å‚™ç¿»è­¯</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div v-for="t in translations" class="bg-gray-50 p-2 rounded-lg border border-gray-100">
                            <div class="text-gray-500 text-xs">{{ t.zh }}</div>
                            <div class="font-bold text-slate-700 text-lg">{{ t.kr }}</div>
                            <div class="text-[10px] text-gray-400">{{ t.pron }}</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-bold text-slate-800 mb-3"><i class="ri-hotel-bed-fill text-purple-500"></i> ä½å®¿</h3>
                    <div v-for="(hotel, idx) in infoList" :key="idx" class="mb-3 pb-3 border-b border-gray-100 last:border-0 last:pb-0">
                        <div class="flex justify-between">
                            <h4 class="font-bold text-slate-700">{{ hotel.name }}</h4>
                            <span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-500">{{ hotel.tag }}</span>
                        </div>
                        <p class="text-xs text-gray-500 my-1">{{ hotel.desc }}</p>
                        <button @click="openMap(hotel.name)" class="text-xs text-blue-500 font-bold flex items-center gap-1">
                            <i class="ri-navigation-fill"></i> å°èˆª
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-bold text-slate-800 mb-3"><i class="ri-suitcase-line text-orange-500"></i> è¡Œææ¸…å–®</h3>
                    <div class="flex gap-2 mb-3">
                        <button @click="activeChecklistTab = 'user1'" :class="`flex-1 text-xs py-1.5 rounded ${activeChecklistTab === 'user1' ? 'bg-orange-100 text-orange-600 font-bold' : 'bg-gray-50'}`">{{ user1Name }}</button>
                        <button @click="activeChecklistTab = 'user2'" :class="`flex-1 text-xs py-1.5 rounded ${activeChecklistTab === 'user2' ? 'bg-orange-100 text-orange-600 font-bold' : 'bg-gray-50'}`">{{ user2Name }}</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div v-for="(item, idx) in currentChecklist" :key="idx" @click="toggleCheck(idx)" class="flex items-center gap-2 p-2 rounded cursor-pointer hover:bg-gray-50">
                            <i :class="item.done ? 'ri-checkbox-circle-fill text-orange-500' : 'ri-checkbox-blank-circle-line text-gray-300'"></i>
                            <span :class="`text-sm ${item.done ? 'text-gray-400 line-through' : 'text-slate-700'}`">{{ item.text }}</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <nav v-show="!showWelcomePage" class="fixed bottom-0 left-0 right-0 glass-nav z-50 pb-safe">
            <div class="grid grid-cols-5 h-16 max-w-lg mx-auto">
                <button @click="currentTab='home'" :class="`flex flex-col items-center justify-center ${currentTab==='home'?'text-blue-600':'text-gray-400'}`">
                    <i class="ri-home-smile-2-fill text-xl mb-0.5"></i><span class="text-[10px]">é¦–é </span>
                </button>
                <button @click="currentTab='schedule'" :class="`flex flex-col items-center justify-center ${currentTab==='schedule'?'text-blue-600':'text-gray-400'}`">
                    <i class="ri-calendar-todo-fill text-xl mb-0.5"></i><span class="text-[10px]">è¡Œç¨‹</span>
                </button>
                <button @click="currentTab='joy'" class="relative -top-5">
                    <div :class="`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transform transition-transform hover:scale-105 ${currentTab==='joy' ? 'bg-yellow-400 text-black' : 'bg-white text-yellow-500 border border-yellow-100'}`">
                        <i class="ri-emotion-happy-line text-3xl"></i>
                    </div>
                    <span class="block text-center text-[10px] font-bold mt-1 text-slate-500">å¿«æ¨‚</span>
                </button>
                <button @click="currentTab='budget'" :class="`flex flex-col items-center justify-center ${currentTab==='budget'?'text-blue-600':'text-gray-400'}`">
                    <i class="ri-wallet-3-fill text-xl mb-0.5"></i><span class="text-[10px]">è¨˜å¸³</span>
                </button>
                <button @click="currentTab='info'" :class="`flex flex-col items-center justify-center ${currentTab==='info'?'text-blue-600':'text-gray-400'}`">
                    <i class="ri-apps-2-fill text-xl mb-0.5"></i><span class="text-[10px]">è³‡è¨Š</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // ç‹€æ…‹
                const showWelcomePage = ref(true);
                const currentTab = ref('home');
                const importCode = ref('');
                
                // åŸºç¤è¨­å®š
                const user1Name = ref('é´¨');
                const user2Name = ref('æº«');
                const exchangeRate = ref(0.024); // é è¨­åŒ¯ç‡
                const daysLeft = ref(0);
                
                // å¤©æ°£æ¨¡æ“¬
                const weather = ref({ temp: 15, desc: 'Sunny' });

                // è³‡æ–™çµæ§‹
                const prepList = ref([
                    {text:'è²·æ©Ÿç¥¨', done:false}, {text:'è¨‚ä½å®¿', done:false}, 
                    {text:'é ç´„è† å›Šåˆ—è»Š', done:false}, {text:'ä¸‹è¼‰ Naver Map', done:false},
                    {text:'è³¼è²· ESIM', done:false}, {text:'ç”³è«‹ Q-Code', done:false}
                ]);
                const newPrepItem = ref('');

                // ä½å®¿è³‡è¨Š
                const infoList = ref([
                    {name:'é‡œå±±é˜¿ç­é£¯åº—', desc:'è¥¿é¢ç«™ï½œä½ç½®æœ€æ–¹ä¾¿ï¼Œé€›è¡—é¦–é¸', tag:'è¥¿é¢'},
                    {name:'Lavalse Hotel', desc:'å½±å³¶ï½œæµ·æ™¯ç„¡æ•µï¼Œé©åˆæ”¾é¬†', tag:'å½±å³¶'}
                ]);

                // è¡Œç¨‹ (è¼•é¬†ç‰ˆ)
                const activeDayIndex = ref(0);
                const itinerary = ref([
                    {
                        day: 1, date: "11/13(äº”)", title: "æŠµé”é‡œå±±", 
                        events: [
                            {time:"14:30", title:"æŠµé”é‡‘æµ·æ©Ÿå ´", desc:"é ˜éŒ¢/WOWPASSï¼Œæ­è¨ˆç¨‹è»Šå»é£¯åº—", mapQuery:"Gimhae Airport"},
                            {time:"17:00", title:"é£¯åº— Check-in", desc:"æ”¾è¡Œæï¼Œç¨å¾®ä¼‘æ¯", mapQuery:"Seomyeon Station"},
                            {time:"18:30", title:"è¥¿é¢å•†åœˆæ™šé¤", desc:"å‘³è´Šç‹é¹½çƒ¤è‚‰ æˆ– è±¬è‚‰æ¹¯é£¯", mapQuery:"Seomyeon Food Alley"},
                            {time:"20:00", title:"Olive Young æƒè²¨", desc:"è¥¿é¢æ——è‰¦åº—æœ€å¥½é€›", mapQuery:"Olive Young Seomyeon"}
                        ]
                    },
                    {
                        day: 2, date: "11/14(å…­)", title: "æµ·é›²å°æ¼«éŠ", 
                        events: [
                            {time:"10:30", title:"ç¡é£½å‡ºç™¼", desc:"å‰å¾€å°¾æµ¦ç«™", mapQuery:"Mipo Station"},
                            {time:"11:30", title:"è† å›Šåˆ—è»Š", desc:"å°¾æµ¦ -> é’æ²™æµ¦ (è¨˜å¾—é ç´„)", mapQuery:"Blue Line Park"},
                            {time:"12:30", title:"é’æ²™æµ¦åˆé¤", desc:"çƒ¤è²æ‘ æˆ– ç¶²ç¾å’–å•¡å»³", mapQuery:"Cheongsapo"},
                            {time:"14:30", title:"æµ·é‚Šåˆ—è»Šå›ç¨‹", desc:"æˆ–æ­è¨ˆç¨‹è»Šå»é€›è¡—", mapQuery:"Songjeong Station"},
                            {time:"19:00", title:"åœ‹éš›ç…™ç«ç¯€", desc:"å»£å®‰é‡Œå¤§æ©‹ (é£¯åº—çœ‹æˆ–æ²™ç˜)", mapQuery:"Gwangalli Beach"}
                        ]
                    },
                    {
                        day: 3, date: "11/15(æ—¥)", title: "æ…¶å·å¤åŸ", 
                        events: [
                            {time:"10:00", title:"å‰å¾€æ…¶å·", desc:"æ­å·´å£«æˆ–åŒ…è»Š (ç´„1hr)", mapQuery:"Gyeongju"},
                            {time:"11:30", title:"ç©¿éŸ“æœ âœ¨", desc:"å¤§é™µè‹‘/çš‡ç†åœ˜è·¯æ‹ç…§", mapQuery:"Hwangnidan-gil"},
                            {time:"13:30", title:"åˆé¤/å’–å•¡", desc:"çš‡ç†åœ˜è·¯éŸ“å±‹é¤å»³", mapQuery:"Hwangnidan-gil Cafe"},
                            {time:"16:00", title:"ç»æ˜Ÿå°", desc:"æ•£æ­¥çœ‹ç²‰ç´…äº‚å­è‰", mapQuery:"Cheomseongdae"},
                            {time:"18:00", title:"æ±å®®èˆ‡æœˆæ± ", desc:"çµ•ç¾å¤œæ™¯å¿…çœ‹", mapQuery:"Donggung Palace and Wolji Pond"}
                        ]
                    },
                    {
                        day: 4, date: "11/16(ä¸€)", title: "ç”˜å·èˆ‡è³¼ç‰©", 
                        events: [
                            {time:"10:30", title:"ç”˜å·æ´æ–‡åŒ–æ‘", desc:"è·Ÿå°ç‹å­æ‹ç…§ (æ—©ä¸Šäººè¼ƒå°‘)", mapQuery:"Gamcheon Culture Village"},
                            {time:"13:00", title:"å—æµ¦æ´/BIFFå»£å ´", desc:"åƒé»‘ç³–é¤…ã€é€›è¡—", mapQuery:"BIFF Square"},
                            {time:"15:00", title:"æ¨‚å¤©è¶…å¸‚", desc:"è²·é›¶é£Ÿä¼´æ‰‹ç¦® (å—æµ¦åº—)", mapQuery:"Lotte Mart Gwangbok"},
                            {time:"18:00", title:"æœ€å¾Œæ™šé¤", desc:"å—æµ¦æ´æµ·é®®æˆ–çƒ¤è…¸", mapQuery:"Nampo-dong Food"}
                        ]
                    },
                    {
                        day: 5, date: "11/17(äºŒ)", title: "å¿«æ¨‚è¿”å®¶", 
                        events: [
                            {time:"11:00", title:"é€€æˆ¿", desc:"æª¢æŸ¥è­·ç…§ã€æˆ°åˆ©å“", mapQuery:""},
                            {time:"12:00", title:"æ©Ÿå ´å…ç¨…åº—", desc:"æœ€å¾Œè£œè²¨", mapQuery:"Gimhae Airport Duty Free"}
                        ]
                    }
                ]);

                // å¿«æ¨‚é é¢è³‡æ–™
                const activeJoyCat = ref('food');
                const joyCategories = [
                    {id:'food', name:'ç¾é£Ÿ'}, {id:'cafe', name:'å’–å•¡'}, 
                    {id:'shop', name:'è³¼ç‰©'}, {id:'snack', name:'å°åƒ'}
                ];
                const joyData = ref({
                    food: [
                        {name:'å‘³è´Šç‹é¹½çƒ¤è‚‰', desc:'è¥¿é¢ï½œå¿…åƒ3.5cmåšåˆ‡äº”èŠ±è‚‰', query:'Matchandeul Wang Sogeum Gui Seomyeon', must:true},
                        {name:'èèŸ»å®¶ (ê°œë¯¸ì§‘)', desc:'å—æµ¦/è¥¿é¢ï½œè¾£ç‚’ç« é­šç‰›è…¸è¦', query:'Gaemijip'},
                        {name:'é›™èƒèƒè±¬è‚‰æ¹¯é£¯', desc:'å¤§æ·µï½œåœ¨åœ°äººæ¨è–¦æ¿ƒéƒæ¹¯é ­', query:'Ssangdung-i Dwaeji Gukbap'},
                        {name:'Eonyang Bulgogi', desc:'æµ·é›²å°ï½œå‚³çµ±éŸ“å¼çƒ¤ç‰›è‚‰', query:'Eonyang Bulgogi Busan'},
                        {name:'Egg Drop', desc:'è¥¿é¢/å—æµ¦ï½œæ—©é¤é¦–é¸åå¸', query:'Egg Drop Busan'}
                    ],
                    cafe: [
                        {name:'Coralani', desc:'æ©Ÿå¼µï½œè¶…ç¾éšæ¢¯æµ·æ™¯å’–å•¡å»³', query:'Coralani', must:true},
                        {name:'Render', desc:'æµ·é›²å°ï½œç°¡ç´„è³ªæ„Ÿé¢¨', query:'Render Cafe Busan'},
                        {name:'Old Mug', desc:'æ¾äº­ï½œç‡Ÿç«èˆ‡æœ¨å±‹æ°›åœ', query:'Old Mug'},
                        {name:'Huinnyeoul Beach', desc:'å½±å³¶ï½œç²‰ç´…å¤•é™½æµ·æ™¯', query:'Huinnyeoul Beach'},
                        {name:'SkÃ¶ll', desc:'è¥¿é¢ï½œç²¾é‡€å•¤é…’èˆ‡åŒ—æ­é¢¨', query:'Skoll Gastropub'}
                    ],
                    shop: [
                        {name:'Olive Young', desc:'è¥¿é¢/å—æµ¦ï½œç¾å¦ä¿é¤Šè–åœ°', query:'Olive Young Seomyeon', must:true},
                        {name:'Gentle Monster', desc:'æ–°ä¸–ç•Œç™¾è²¨ï½œå¢¨é¡æ½®ç‰Œ', query:'Gentle Monster Busan'},
                        {name:'æ¨‚å¤©ç™¾è²¨å…‰å¾©åº—', desc:'å—æµ¦ï½œæœ‰éŸ³æ¨‚å™´æ³‰èˆ‡è¶…å¸‚', query:'Lotte Department Store Gwangbok'},
                        {name:'NCç™¾è²¨', desc:'è¥¿é¢ï½œå¹³åƒ¹æœé£¾å¥½è²·', query:'NC Department Store Seomyeon'},
                        {name:'Object', desc:'è¥¿é¢ï½œæ–‡å‰µå°ç‰©èˆ‡è²¼ç´™', query:'Object Seomyeon'}
                    ],
                    snack: [
                        {name:'å…ƒç¥–é»‘ç³–é¤…', desc:'BIFFå»£å ´ï½œæ’éšŠç¾é£Ÿ', query:'Busan Hotteok'},
                        {name:'å¤ä¾†æ€é­šç³•', desc:'æµ·é›²å°ï½œè¶…äººæ°£é­šæ¿', query:'Goraesa Fish Cake'},
                        {name:'æå®¶è¾£ç‚’å¹´ç³•', desc:'å¯Œå¹³å¸‚å ´ï½œè˜¿è””çµ²å¹´ç³•', query:'Igane Tteokbokki'},
                        {name:'31cm æµ·é®®åˆ€å‰Šéºµ', desc:'æµ·é›²å°ï½œè¶…å¤§ç¢—è²é¡', query:'31cm Haemul Kalguksu'},
                        {name:'é›ªå†° (Sulbing)', desc:'éš¨è™•ï½œå“ˆå¯†ç“œè‰è“å†°', query:'Sulbing Busan'}
                    ]
                });

                // è¨˜å¸³
                const activeBudgetTab = ref('public');
                const newItemName = ref('');
                const newItemPrice = ref('');
                const publicExpenses = ref([]);
                const user1Expenses = ref([]);
                const user2Expenses = ref([]);

                // ç¿»è­¯
                const translations = [
                    {zh:'ä½ å¥½', kr:'ì•ˆë…•í•˜ì„¸ìš”', pron:'An-nyeong-ha-se-yo'},
                    {zh:'è¬è¬', kr:'ê°ì‚¬í•©ë‹ˆë‹¤', pron:'Kam-sa-ham-ni-da'},
                    {zh:'é€™å€‹å¤šå°‘éŒ¢?', kr:'ì´ê±° ì–¼ë§ˆì˜ˆìš”?', pron:'I-geo eol-ma-ye-yo?'},
                    {zh:'è«‹çµ¦æˆ‘é€™å€‹', kr:'ì´ê±° ì£¼ì„¸ìš”', pron:'I-geo ju-se-yo'},
                    {zh:'æ´—æ‰‹é–“åœ¨å“ª?', kr:'í™”ì¥ì‹¤ ì–´ë””ì˜ˆìš”?', pron:'Hwa-jang-sil eo-di-ye-yo?'},
                    {zh:'è«‹ç®—ä¾¿å®œé»', kr:'ê¹ì•„ì£¼ì„¸ìš”', pron:'Kka-kka-ju-se-yo'}
                ];

                // è¡Œææ¸…å–®
                const activeChecklistTab = ref('user1');
                const user1Packing = ref([
                    {text:'è­·ç…§',done:false}, {text:'WOWPASS',done:false}, {text:'è½‰æ¥é ­',done:false}, 
                    {text:'å……é›»ç·š',done:false}, {text:'å€‹äººè—¥å“',done:false}, {text:'ç¶²å¡æ†‘è­‰',done:false}
                ]);
                const user2Packing = ref([
                    {text:'è­·ç…§',done:false}, {text:'WOWPASS',done:false}, {text:'è½‰æ¥é ­',done:false}, 
                    {text:'åŒ–å¦åŒ…',done:false}, {text:'é›¢å­å¤¾',done:false}, {text:'ç¡è¡£',done:false}
                ]);

                // è¨ˆç®—é‚è¼¯
                const currentBudgetList = computed(() => {
                    if(activeBudgetTab.value === 'public') return publicExpenses.value;
                    return activeBudgetTab.value === 'user1' ? user1Expenses.value : user2Expenses.value;
                });
                
                const currentTotal = computed(() => currentBudgetList.value.reduce((s,i) => s + Number(i.price), 0));

                const currentChecklist = computed(() => activeChecklistTab.value === 'user1' ? user1Packing.value : user2Packing.value);

                // --- æ ¸å¿ƒåŠŸèƒ½ ---

                // å„²å­˜
                const saveData = () => {
                    const data = {
                        user1Name: user1Name.value, user2Name: user2Name.value, exchangeRate: exchangeRate.value,
                        prepList: prepList.value, itinerary: itinerary.value,
                        public: publicExpenses.value, u1Exp: user1Expenses.value, u2Exp: user2Expenses.value,
                        u1Pack: user1Packing.value, u2Pack: user2Packing.value
                    };
                    localStorage.setItem('busan_2026_joy', JSON.stringify(data));
                };

                // è®€å–
                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('busan_2026_joy');
                        if (saved) {
                            const d = JSON.parse(saved);
                            if(d.user1Name) user1Name.value = d.user1Name;
                            if(d.user2Name) user2Name.value = d.user2Name;
                            if(d.exchangeRate) exchangeRate.value = d.exchangeRate;
                            if(d.prepList) prepList.value = d.prepList;
                            if(d.itinerary) itinerary.value = d.itinerary;
                            if(d.public) publicExpenses.value = d.public;
                            if(d.u1Exp) user1Expenses.value = d.u1Exp;
                            if(d.u2Exp) user2Expenses.value = d.u2Exp;
                            if(d.u1Pack) user1Packing.value = d.u1Pack;
                            if(d.u2Pack) user2Packing.value = d.u2Pack;
                        }
                    } catch(e) { console.error("Load Error", e); }
                };

                // åŒ¯å‡º (Base64 ç·¨ç¢¼ä»¥ç¸®çŸ­è¦–è¦ºé•·åº¦)
                const exportData = () => {
                    saveData();
                    const json = JSON.stringify(localStorage.getItem('busan_2026_joy'));
                    // ç°¡å–®ç·¨ç¢¼ï¼ŒéåŠ å¯†
                    const encoded = btoa(unescape(encodeURIComponent(json))); 
                    navigator.clipboard.writeText(encoded).then(() => alert("ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\nè«‹å­˜åˆ° Line æˆ–è¨˜äº‹æœ¬ã€‚"));
                };

                // åŒ¯å…¥
                const processImport = () => {
                    if(!importCode.value) return;
                    try {
                        // è§£ç¢¼
                        const jsonString = decodeURIComponent(escape(atob(importCode.value)));
                        const rawData = JSON.parse(jsonString); // é€™æ˜¯å­˜å…¥ LS çš„å­—ä¸²
                        // é©—è­‰ä¸¦å¯«å…¥
                        localStorage.setItem('busan_2026_joy', JSON.parse(rawData)); 
                        alert("åŒ¯å…¥æˆåŠŸï¼é–‹å•Ÿæ—…ç¨‹...");
                        location.reload();
                    } catch(e) {
                        alert("ä»£ç¢¼æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªæ˜¯å¦å®Œæ•´è¤‡è£½ã€‚");
                    }
                };

                // Watchers
                watch([user1Name, user2Name, exchangeRate, prepList, itinerary, publicExpenses, user1Expenses, user2Expenses, user1Packing, user2Packing], saveData, {deep:true});

                // CRUD
                const addPrep = () => { if(newPrepItem.value) { prepList.value.push({text:newPrepItem.value, done:false}); newPrepItem.value=''; }};
                const deletePrep = (i) => prepList.value.splice(i,1);
                const addItem = () => { 
                    if(newItemName.value && newItemPrice.value) {
                        currentBudgetList.value.push({name:newItemName.value, price:newItemPrice.value});
                        newItemName.value=''; newItemPrice.value='';
                    }
                };
                const deleteItem = (i) => currentBudgetList.value.splice(i,1);
                const toggleCheck = (i) => { currentChecklist.value[i].done = !currentChecklist.value[i].done; };
                
                // Utils
                const openMap = (q) => window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(q)}`, '_blank');
                const enterApp = () => showWelcomePage.value = false;
                
                // å€’æ•¸
                onMounted(() => {
                    loadData();
                    const target = new Date("2026-11-13").getTime();
                    const now = new Date().getTime();
                    daysLeft.value = Math.max(0, Math.floor((target - now) / (1000 * 60 * 60 * 24)));
                });

                return {
                    showWelcomePage, enterApp, currentTab, importCode, processImport, exportData,
                    user1Name, user2Name, exchangeRate, daysLeft, weather,
                    prepList, addPrep, deletePrep, newPrepItem,
                    itinerary, activeDayIndex, openMap,
                    joyCategories, activeJoyCat, joyData,
                    activeBudgetTab, currentTotal, newItemName, newItemPrice, addItem, deleteItem, currentBudgetList,
                    translations, infoList, activeChecklistTab, currentChecklist, toggleCheck
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
