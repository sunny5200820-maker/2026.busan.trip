<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é‡œå±±èŠ±ç«ä¹‹æ—…</title>
    
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            alert("âš ï¸ éŒ¯èª¤ï¼š" + msg);
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* å…¨åŸŸè¨­å®š */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            background-attachment: fixed;
            color: #334155;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* é˜²æ­¢ä¸‹æ‹‰é‡æ•´ */
        }
        
        /* æ­¡è¿é å…¨è¢å¹• */
        #welcome-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 80px;
        }

        /* æ¯›ç»ç’ƒå¡ç‰‡ (Glassmorphism) */
        .glass-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* åº•éƒ¨å°èˆª */
        .glass-nav { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            border-top: 1px solid rgba(255,255,255,0.5); 
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* éš±è— Scrollbar */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ç¿»è­¯æ”¾å¤§ Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }

        /* æ‡¸æµ®ç›¸æ©ŸæŒ‰éˆ• */
        .camera-float-btn {
            position: fixed; bottom: 100px; right: 20px;
            width: 56px; height: 56px;
            background: #2563eb; color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            z-index: 90;
            font-size: 24px;
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen relative flex flex-col">
        
        <div id="welcome-layer" v-if="showWelcomePage" :style="{ backgroundImage: `url('./welcome.jpg')` }">
            <div class="bg-black/40 absolute inset-0"></div>
            
            <div class="relative z-10 w-full px-8 text-center pb-10">
                <h1 class="text-4xl font-bold text-white mb-2 tracking-widest drop-shadow-lg">BUSAN 2026</h1>
                <p class="text-white/80 text-sm tracking-widest mb-10">HAPPY TRIP WITH DUCK & WEN</p>
                
                <button @click="enterApp" class="w-full bg-white/20 backdrop-blur-md border border-white/50 text-white py-3 rounded-full font-bold shadow-lg mb-6 hover:bg-white/30 transition-all">
                    é€²å…¥æ—…ç¨‹
                </button>

                <div class="bg-black/50 backdrop-blur-md p-4 rounded-2xl border border-white/10">
                    <div class="flex gap-2">
                        <input v-model="importCode" placeholder="è²¼ä¸Šè¡Œç¨‹ä»£ç¢¼..." class="flex-1 bg-white/10 border border-white/30 rounded-lg px-3 py-2 text-sm text-white outline-none">
                        <button @click="processImport" class="bg-purple-500 text-white px-4 rounded-lg text-sm font-bold">åŒ¯å…¥</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-else class="flex-1 flex flex-col max-w-md mx-auto w-full pb-24 overflow-x-hidden">
            
            <div class="absolute top-4 right-4 z-20">
                <button @click="exportData" class="glass-card px-3 py-1.5 text-slate-700 text-xs font-bold flex items-center gap-1 bg-white/60">
                    <i class="ri-save-3-line"></i> å­˜æª”/åŒ¯å‡º
                </button>
            </div>

            <div v-if="currentTab === 'home'" class="flex-1 flex flex-col justify-center px-6 space-y-6 min-h-[85vh]">
                
                <form action="https://www.google.com/search" target="_blank" class="w-full relative">
                    <i class="ri-google-fill absolute left-3 top-2.5 text-slate-400 text-lg"></i>
                    <input type="text" name="q" placeholder="æœå°‹é‡œå±±æ™¯é»..." class="w-full pl-10 pr-4 py-3 rounded-full bg-white/80 border-none shadow-sm text-sm outline-none focus:ring-2 focus:ring-purple-300">
                </form>

                <div class="text-center">
                    <div class="inline-block bg-white/30 px-3 py-1 rounded-full text-xs font-bold text-slate-700 mb-2 border border-white/40">
                        2026.11.13 - 11.17
                    </div>
                    <h1 class="text-4xl font-bold text-slate-800 drop-shadow-sm mb-6 leading-tight">é‡œå±±æ…¶å·<br>æ…¢æ´»ä¹‹æ—… ğŸ‡°ğŸ‡·</h1>
                    
                    <div class="flex justify-center gap-4">
                        <div class="glass-card p-4 w-32 flex flex-col items-center justify-center bg-white/40">
                            <span class="text-3xl font-bold font-mono text-purple-700">{{ daysLeft }}</span>
                            <span class="text-[10px] uppercase text-slate-500 font-bold">Days Left</span>
                        </div>
                        <div class="glass-card p-4 w-32 flex flex-col items-center justify-center bg-white/40">
                            <div class="flex items-center gap-1">
                                <i class="ri-sun-cloudy-line text-2xl text-orange-400"></i>
                                <span class="text-xl font-bold text-slate-700">12Â°</span>
                            </div>
                            <span class="text-[10px] uppercase text-slate-500 font-bold">é‡œå±±å¤©æ°£</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-5 bg-white/50">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-slate-800"><i class="ri-checkbox-multiple-line text-purple-600"></i> å¾…è¾¦äº‹é …</h3>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-bold">{{ prepList.filter(i=>!i.done).length }} å¾…å®Œæˆ</span>
                    </div>
                    <div class="space-y-2 mb-3 max-h-40 overflow-y-auto">
                        <div v-for="(item, idx) in prepList" :key="idx" @click="item.done = !item.done" class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/50 cursor-pointer transition">
                            <i :class="item.done ? 'ri-checkbox-circle-fill text-green-500' : 'ri-checkbox-blank-circle-line text-slate-400'" class="text-xl"></i>
                            <span :class="item.done ? 'line-through text-slate-400' : 'text-slate-800'">{{ item.text }}</span>
                            <button @click.stop="deletePrep(idx)" class="ml-auto text-slate-300 hover:text-red-500"><i class="ri-close-line"></i></button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input v-model="newPrepItem" placeholder="æ–°å¢å¾…è¾¦..." class="flex-1 bg-white/60 border-none rounded-lg px-3 py-2 text-sm outline-none">
                        <button @click="addPrep" class="bg-purple-600 text-white w-9 h-9 rounded-lg"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'schedule'" class="flex-1 px-4 pt-16">
                <div class="flex overflow-x-auto space-x-3 pb-4 hide-scrollbar mb-2">
                    <button v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                        :class="`flex-shrink-0 px-5 py-2 rounded-full text-sm font-bold shadow-sm transition-all ${activeDayIndex === index ? 'bg-purple-600 text-white' : 'glass-card text-slate-600 bg-white/60'}`">
                        Day {{ day.day }}
                    </button>
                </div>
                
                <div class="glass-card p-5 bg-white/70 min-h-[60vh]">
                    <div class="flex justify-between items-end mb-6 border-b border-slate-200 pb-3">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">{{ itinerary[activeDayIndex].title }}</h2>
                            <p class="text-sm text-purple-600 font-bold mt-1">{{ itinerary[activeDayIndex].date }}</p>
                        </div>
                        <button @click="addEventModal = true" class="bg-slate-800 text-white text-xs px-3 py-1.5 rounded-full font-bold flex items-center gap-1">
                            <i class="ri-add-line"></i> æ–°å¢è¡Œç¨‹
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div v-for="(event, idx) in itinerary[activeDayIndex].events" :key="idx" class="relative pl-4 border-l-2 border-slate-300 group">
                            <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-purple-500 border-2 border-white"></div>
                            
                            <div v-if="!event.isEditing">
                                <div class="flex justify-between items-start">
                                    <span class="text-xs font-mono font-bold text-slate-500 bg-slate-100 px-1.5 rounded">{{ event.time }}</span>
                                    <div class="flex gap-1 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                                        <button @click="moveEvent(idx, -1)" :disabled="idx===0" class="text-slate-400 hover:text-blue-500 disabled:opacity-30"><i class="ri-arrow-up-s-line"></i></button>
                                        <button @click="moveEvent(idx, 1)" :disabled="idx===itinerary[activeDayIndex].events.length-1" class="text-slate-400 hover:text-blue-500 disabled:opacity-30"><i class="ri-arrow-down-s-line"></i></button>
                                        <button @click="event.isEditing = true" class="text-slate-400 hover:text-orange-500 ml-1"><i class="ri-edit-line"></i></button>
                                        <button @click="deleteEvent(idx)" class="text-slate-400 hover:text-red-500 ml-1"><i class="ri-delete-bin-line"></i></button>
                                    </div>
                                </div>
                                <h4 class="font-bold text-slate-800 text-lg mt-1">{{ event.title }}</h4>
                                <p class="text-sm text-slate-600 leading-relaxed">{{ event.desc }}</p>
                                <button v-if="event.mapQuery" @click="openMap(event.mapQuery)" class="mt-2 text-xs bg-green-100 text-green-700 px-2 py-1 rounded border border-green-200 flex items-center gap-1 w-fit">
                                    <i class="ri-map-pin-fill"></i> åœ°åœ–å°èˆª
                                </button>
                            </div>

                            <div v-else class="bg-white p-3 rounded-lg shadow-sm border border-purple-200">
                                <div class="grid grid-cols-4 gap-2 mb-2">
                                    <input v-model="event.time" class="col-span-1 p-1 text-sm border rounded bg-gray-50" placeholder="æ™‚é–“">
                                    <input v-model="event.title" class="col-span-3 p-1 text-sm border rounded bg-gray-50" placeholder="æ¨™é¡Œ">
                                </div>
                                <textarea v-model="event.desc" class="w-full p-1 text-sm border rounded bg-gray-50 mb-2" rows="2" placeholder="å‚™è¨»"></textarea>
                                <input v-model="event.mapQuery" class="w-full p-1 text-sm border rounded bg-gray-50 mb-2" placeholder="åœ°åœ–é—œéµå­—">
                                <button @click="event.isEditing = false" class="w-full bg-purple-600 text-white text-xs py-1.5 rounded font-bold">å®Œæˆ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'joy'" class="flex-1 px-5 pt-16 pb-20">
                <div class="glass-card p-3 mb-6 sticky top-4 z-20 flex justify-around bg-white/80">
                    <button v-for="cat in joyCategories" :key="cat.id" @click="activeJoyCat = cat.id"
                        :class="`flex flex-col items-center gap-1 text-xs font-bold transition-colors ${activeJoyCat === cat.id ? 'text-purple-700' : 'text-slate-400'}`">
                        <div :class="`w-10 h-10 rounded-full flex items-center justify-center text-lg ${activeJoyCat === cat.id ? 'bg-purple-100 shadow-inner' : 'bg-slate-100'}`">
                            <i :class="cat.icon"></i>
                        </div>
                        {{ cat.name }}
                    </button>
                </div>

                <div class="space-y-4">
                    <div v-for="shop in joyData[activeJoyCat]" :key="shop.name" class="glass-card p-4 flex justify-between items-center bg-white/60">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 flex-wrap">
                                <h3 class="font-bold text-slate-800">{{ shop.name }}</h3>
                                <span v-if="shop.must" class="text-[10px] bg-red-500 text-white px-1.5 rounded font-bold">å¿…åƒ</span>
                            </div>
                            <p class="text-xs text-slate-600 mt-1">{{ shop.desc }}</p>
                        </div>
                        <button @click="openMap(shop.query)" class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center shadow hover:bg-green-600 ml-2 flex-shrink-0">
                            <i class="ri-direction-fill text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="flex-1 px-5 pt-16 pb-24">
                
                <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden mb-6">
                    <i class="ri-money-cny-circle-line absolute -bottom-4 -right-4 text-9xl text-white/5 rotate-12"></i>
                    
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-xs font-bold text-slate-400 bg-slate-700 px-2 py-1 rounded">å…¬å¸³ç¸½è¦½</span>
                            
                            <div class="text-right">
                                <div class="flex items-center justify-end gap-1 mb-1">
                                    <span class="text-[10px] text-slate-400">å³æ™‚åŒ¯ç‡</span>
                                    <button @click="fetchRate" class="text-xs text-blue-400 hover:text-white"><i class="ri-refresh-line"></i></button>
                                </div>
                                <div class="flex items-center bg-slate-700 rounded px-2 py-1 border border-slate-600">
                                    <span class="text-[10px] text-slate-400 mr-1">1 â‚© =</span>
                                    <input type="number" step="0.0001" v-model="exchangeRate" class="w-14 bg-transparent text-right text-xs text-yellow-300 font-mono outline-none">
                                    <span class="text-[10px] text-slate-400 ml-1">TWD</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-baseline gap-2 mt-2">
                            <h2 class="text-4xl font-bold font-mono">â‚©{{ publicTotal.toLocaleString() }}</h2>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-slate-600 flex justify-between items-center">
                            <div class="text-sm text-slate-300">æ¯äººæ‡‰ä»˜ (é™¤ä»¥2)</div>
                            <div class="text-right">
                                <div class="text-xl font-bold text-green-400 font-mono">â‚©{{ Math.round(publicTotal / 2).toLocaleString() }}</div>
                                <div class="text-[10px] text-slate-500">â‰ˆ TWD {{ Math.round((publicTotal/2)*exchangeRate).toLocaleString() }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-5 bg-white/70">
                    <div class="flex bg-white/50 p-1 rounded-xl mb-4">
                        <button @click="activeBudgetTab = 'public'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${activeBudgetTab==='public'?'bg-slate-800 text-white shadow':'text-slate-500'}`">å…¬å¸³</button>
                        <button @click="activeBudgetTab = 'user1'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${activeBudgetTab==='user1'?'bg-slate-800 text-white shadow':'text-slate-500'}`">{{ user1Name }}</button>
                        <button @click="activeBudgetTab = 'user2'" :class="`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${activeBudgetTab==='user2'?'bg-slate-800 text-white shadow':'text-slate-500'}`">{{ user2Name }}</button>
                    </div>

                    <div v-if="activeBudgetTab !== 'public'" class="mb-3 text-right">
                        <label class="text-xs text-slate-400 mr-2">ç·¨è¼¯åç¨±:</label>
                        <input v-if="activeBudgetTab === 'user1'" v-model="user1Name" class="text-xs bg-transparent border-b border-slate-400 w-20 text-center focus:outline-none text-slate-800 font-bold">
                        <input v-if="activeBudgetTab === 'user2'" v-model="user2Name" class="text-xs bg-transparent border-b border-slate-400 w-20 text-center focus:outline-none text-slate-800 font-bold">
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input v-model="newItemName" placeholder="å“é … (å¦‚: çƒ¤è‚‰)" class="flex-1 bg-white border-none rounded-lg px-3 py-2 text-sm outline-none shadow-sm">
                        <input v-model="newItemPrice" type="number" placeholder="â‚© é‡‘é¡" class="w-24 bg-white border-none rounded-lg px-3 py-2 text-sm outline-none font-mono shadow-sm">
                        <button @click="addItem" class="bg-slate-800 text-white w-10 rounded-lg flex items-center justify-center shadow-sm hover:bg-slate-700"><i class="ri-add-line"></i></button>
                    </div>

                    <div class="space-y-2 max-h-60 overflow-y-auto pr-1">
                        <div v-for="(item, idx) in currentBudgetList" :key="idx" class="flex justify-between items-center p-3 bg-white/40 rounded-lg border border-white/60">
                            <span class="text-sm text-slate-700 font-medium">{{ item.name }}</span>
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-mono font-bold text-slate-800">â‚©{{ parseInt(item.price).toLocaleString() }}</span>
                                <button @click="deleteItem(idx)" class="text-slate-400 hover:text-red-500"><i class="ri-close-circle-line text-lg"></i></button>
                            </div>
                        </div>
                        <div v-if="currentBudgetList.length === 0" class="text-center text-xs text-slate-400 py-4">å°šç„¡ç´€éŒ„</div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="flex-1 px-5 pt-16 pb-24 space-y-4">
                
                <div class="glass-card p-4 bg-white/70">
                    <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2"><i class="ri-bus-fill text-blue-500"></i> äº¤é€šæŒ‡å—</h3>
                    <div class="text-xs text-slate-600 space-y-2">
                        <p>ğŸš• <span class="font-bold text-slate-800">è¨ˆç¨‹è»Š (Kakao T)</span>: èµ·è·³åƒ¹ç´„ 4,800â‚©ã€‚è«‹ç›´æ¥ç”¨ App å«è»Šï¼Œä¸¦é¸æ“‡ã€Œè‡ªå‹•ä»˜æ¬¾ã€é¿å…çˆ­è­°ã€‚</p>
                        <p>ğŸš‡ <span class="font-bold text-slate-800">åœ°éµ/å…¬è»Š</span>: ä¸Šä¸‹è»Šéƒ½è¦åˆ· WOWPASS/T-Moneyã€‚</p>
                        <p>ğŸš† <span class="font-bold text-slate-800">å‰å¾€æ…¶å·</span>: å»ºè­°å¾é‡œå±±ç«™æ­ KTX (ç´„30åˆ†) æˆ– è€åœƒç«™æ­å·´å£« (ç´„50åˆ†)ã€‚</p>
                    </div>
                </div>

                <div class="glass-card p-4 bg-white/70">
                    <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2"><i class="ri-hotel-bed-fill text-purple-500"></i> ä½å®¿è³‡è¨Š</h3>
                    <div class="space-y-3">
                        <div class="border-b border-slate-200 pb-2 last:border-0 last:pb-0">
                            <div class="flex justify-between">
                                <span class="font-bold text-sm text-slate-700">é˜¿ç­é£¯åº— (Arban Hotel)</span>
                                <span class="text-[10px] bg-slate-100 px-1 rounded text-slate-500">è¥¿é¢</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">äº¤é€šæœ€æ–¹ä¾¿ï¼Œæ¨“ä¸‹å°±æ˜¯å•†åœˆã€‚</p>
                            <button @click="openMap('Arban Hotel Busan')" class="text-xs text-blue-500 font-bold mt-1"><i class="ri-map-pin-line"></i> å°èˆª</button>
                        </div>
                        <div>
                            <div class="flex justify-between">
                                <span class="font-bold text-sm text-slate-700">Lavalse Hotel</span>
                                <span class="text-[10px] bg-slate-100 px-1 rounded text-slate-500">å½±å³¶</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">çµ•ç¾æµ·æ™¯èˆ‡å¤§æ©‹æ™¯è§€ã€‚</p>
                            <button @click="openMap('Lavalse Hotel Busan')" class="text-xs text-blue-500 font-bold mt-1"><i class="ri-map-pin-line"></i> å°èˆª</button>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-4 bg-white/70">
                    <h3 class="font-bold text-slate-800 mb-3"><i class="ri-translate-2 text-green-600"></i> å¿…å‚™ç¿»è­¯</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <div v-for="(t, i) in translations" :key="i" class="bg-white p-2 rounded-lg border border-slate-100 shadow-sm hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <span class="text-[10px] text-slate-400">{{ t.zh }}</span>
                                <div class="flex gap-1">
                                    <button @click="speak(t.kr)" class="text-slate-400 hover:text-blue-500"><i class="ri-volume-up-fill"></i></button>
                                    <button @click="enlargeText(t.kr)" class="text-slate-400 hover:text-purple-500"><i class="ri-fullscreen-fill"></i></button>
                                </div>
                            </div>
                            <div class="font-bold text-slate-800 text-sm mt-1">{{ t.kr }}</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-4 bg-white/70">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-slate-800"><i class="ri-suitcase-line text-orange-500"></i> è¡Œææ¸…å–®</h3>
                        <div class="flex bg-slate-100 rounded-lg p-0.5">
                            <button @click="activeChecklistTab='user1'" :class="`px-3 py-0.5 text-xs rounded-md transition-all ${activeChecklistTab==='user1'?'bg-white shadow text-slate-800 font-bold':'text-slate-400'}`">{{ user1Name }}</button>
                            <button @click="activeChecklistTab='user2'" :class="`px-3 py-0.5 text-xs rounded-md transition-all ${activeChecklistTab==='user2'?'bg-white shadow text-slate-800 font-bold':'text-slate-400'}`">{{ user2Name }}</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div v-for="(item, idx) in currentChecklist" :key="idx" class="flex items-center gap-2 p-2 bg-white/50 rounded hover:bg-white cursor-pointer group">
                            <div @click="toggleCheck(idx)" class="flex items-center gap-2 flex-1">
                                <i :class="item.done ? 'ri-checkbox-circle-fill text-orange-500' : 'ri-checkbox-blank-circle-line text-slate-300'"></i>
                                <span :class="`text-xs ${item.done ? 'text-slate-400 line-through' : 'text-slate-700'}`">{{ item.text }}</span>
                            </div>
                            <button @click="deleteCheckItem(idx)" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i class="ri-close-line"></i></button>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 border-t border-slate-200 pt-2">
                        <input v-model="newCheckItem" placeholder="æ–°å¢ç‰©å“..." class="flex-1 bg-white text-xs px-2 py-1.5 rounded border-none outline-none">
                        <button @click="addCheckItem" class="bg-orange-500 text-white px-3 py-1 rounded text-xs"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

        </div>

        <a href="https://lens.google.com/" target="_blank" v-if="currentTab === 'info'" class="camera-float-btn hover:scale-110 transition-transform">
            <i class="ri-camera-lens-line"></i>
        </a>

        <nav v-show="!showWelcomePage" class="fixed bottom-0 left-0 right-0 glass-nav z-50">
            <div class="grid grid-cols-5 h-16 max-w-md mx-auto items-center">
                <button @click="currentTab='home'" :class="`flex flex-col items-center ${currentTab==='home'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-home-smile-2-fill text-xl"></i><span class="text-[10px] mt-0.5">é¦–é </span>
                </button>
                <button @click="currentTab='schedule'" :class="`flex flex-col items-center ${currentTab==='schedule'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-calendar-todo-fill text-xl"></i><span class="text-[10px] mt-0.5">è¡Œç¨‹</span>
                </button>
                <button @click="currentTab='joy'" class="relative -top-5">
                    <div :class="`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transform transition-all ${currentTab==='joy' ? 'bg-gradient-to-tr from-purple-500 to-pink-500 text-white scale-110' : 'bg-white text-purple-300 border border-slate-100'}`">
                        <i class="ri-emotion-happy-line text-3xl"></i>
                    </div>
                </button>
                <button @click="currentTab='budget'" :class="`flex flex-col items-center ${currentTab==='budget'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-wallet-3-fill text-xl"></i><span class="text-[10px] mt-0.5">è¨˜å¸³</span>
                </button>
                <button @click="currentTab='info'" :class="`flex flex-col items-center ${currentTab==='info'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-apps-2-fill text-xl"></i><span class="text-[10px] mt-0.5">è³‡è¨Š</span>
                </button>
            </div>
        </nav>

        <div v-if="enlargeModal.show" class="modal-overlay" @click="enlargeModal.show = false">
            <div class="bg-white p-8 rounded-2xl w-[90%] text-center" @click.stop>
                <p class="text-4xl font-bold text-slate-800 mb-6 leading-relaxed">{{ enlargeModal.text }}</p>
                <button @click="enlargeModal.show = false" class="bg-slate-800 text-white px-6 py-2 rounded-full font-bold">é—œé–‰</button>
            </div>
        </div>

        <div v-if="addEventModal" class="modal-overlay" @click="addEventModal = false">
            <div class="bg-white p-6 rounded-2xl w-[85%] max-w-sm" @click.stop>
                <h3 class="font-bold text-lg mb-4 text-slate-800">æ–°å¢è¡Œç¨‹è‡³ Day {{ itinerary[activeDayIndex].day }}</h3>
                <input v-model="newEvent.time" placeholder="æ™‚é–“ (å¦‚ 14:00)" class="w-full mb-3 p-2 bg-gray-50 border rounded text-sm">
                <input v-model="newEvent.title" placeholder="æ¨™é¡Œ" class="w-full mb-3 p-2 bg-gray-50 border rounded text-sm">
                <textarea v-model="newEvent.desc" placeholder="å‚™è¨»" class="w-full mb-3 p-2 bg-gray-50 border rounded text-sm" rows="2"></textarea>
                <input v-model="newEvent.mapQuery" placeholder="åœ°åœ–é—œéµå­— (Naver Map)" class="w-full mb-4 p-2 bg-gray-50 border rounded text-sm">
                <div class="flex gap-2">
                    <button @click="addEventModal = false" class="flex-1 bg-gray-200 text-slate-600 py-2 rounded font-bold">å–æ¶ˆ</button>
                    <button @click="addEvent" class="flex-1 bg-purple-600 text-white py-2 rounded font-bold">æ–°å¢</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // UI ç‹€æ…‹
                const showWelcomePage = ref(true);
                const currentTab = ref('home');
                const importCode = ref('');
                const addEventModal = ref(false);
                const enlargeModal = ref({ show:false, text:'' });
                
                // æ ¸å¿ƒè³‡æ–™
                const user1Name = ref('é´¨');
                const user2Name = ref('æº«');
                const exchangeRate = ref(0.024);
                const daysLeft = ref(0);

                // 1. å¾…è¾¦æ¸…å–®
                const prepList = ref([
                    {text:'è²·æ©Ÿç¥¨', done:false}, {text:'è¨‚ä½å®¿', done:false}, 
                    {text:'è† å›Šåˆ—è»Šé ç´„', done:false}, {text:'è³¼è²· ESIM', done:false}
                ]);
                const newPrepItem = ref('');

                // 2. è¡Œç¨‹è³‡æ–™
                const activeDayIndex = ref(0);
                const newEvent = ref({ time:'', title:'', desc:'', mapQuery:'' });
                const itinerary = ref([
                    {
                        day:1, date:"11/13(äº”)", title:"æŠµé”é‡œå±±", 
                        events:[
                            {time:"14:30", title:"æŠµé”é‡‘æµ·æ©Ÿå ´", desc:"é ˜éŒ¢ / æ­è¨ˆç¨‹è»Š", mapQuery:"Gimhae Airport", isEditing:false}, 
                            {time:"18:00", title:"å‘³è´Šç‹é¹½çƒ¤è‚‰", desc:"è¥¿é¢åº—ï¼Œå¿…åƒ3.5cmäº”èŠ±è‚‰", mapQuery:"Matchandeul Wang Sogeum Gui Seomyeon", isEditing:false},
                            {time:"20:00", title:"Olive Young", desc:"è¥¿é¢æ——è‰¦åº—å¤§æ¡è³¼", mapQuery:"Olive Young Seomyeon", isEditing:false}
                        ]
                    },
                    {
                        day:2, date:"11/14(å…­)", title:"æµ·é›²å°&ç…™ç«", 
                        events:[
                            {time:"11:30", title:"è† å›Šåˆ—è»Š", desc:"å°¾æµ¦ -> é’æ²™æµ¦ (è¨˜å¾—é ç´„)", mapQuery:"Mipo Station", isEditing:false}, 
                            {time:"12:30", title:"é’æ²™æµ¦åˆé¤", desc:"ç§€æ•å®¶ç‚­ç«çƒ¤è² æˆ– ç¶²ç¾å’–å•¡", mapQuery:"Suminene", isEditing:false}, 
                            {time:"15:00", title:"æµ·é›²å°å¸‚å ´", desc:"åƒç³–é¤…ã€ç›²é°»", mapQuery:"Haeundae Market", isEditing:false},
                            {time:"19:00", title:"é‡œå±±åœ‹éš›ç…™ç«ç¯€", desc:"å»£å®‰é‡Œæµ·æ°´æµ´å ´ (æˆ–é£¯åº—è§€çœ‹)", mapQuery:"Gwangalli Beach", isEditing:false}
                        ]
                    },
                    {
                        day:3, date:"11/15(æ—¥)", title:"æ…¶å·å¤åŸ", 
                        events:[
                            {time:"11:00", title:"å¤§é™µè‹‘", desc:"åƒè§€å¤©é¦¬å¡šï¼Œæ•£æ­¥æ‹ç…§", mapQuery:"Daereungwon", isEditing:false},
                            {time:"12:30", title:"ç©¿éŸ“æœ", desc:"æ¨è–¦ Dorandoranï¼Œåœ¨éŸ“å±‹ç‰†æ‹ç…§", mapQuery:"Gyeongju Hanbok", isEditing:false},
                            {time:"14:00", title:"çš‡ç†åœ˜è·¯", desc:"æ–‡é’å°åº—ã€å’–å•¡å»³å·¡ç¦®", mapQuery:"Hwangnidan-gil", isEditing:false},
                            {time:"18:00", title:"æ±å®®èˆ‡æœˆæ± ", desc:"å¿…çœ‹çµ•ç¾å¤œæ™¯", mapQuery:"Donggung Palace and Wolji Pond", isEditing:false}
                        ]
                    },
                    {
                        day:4, date:"11/16(ä¸€)", title:"ç”˜å·èˆ‡è³¼ç‰©", 
                        events:[
                            {time:"10:30", title:"ç”˜å·æ´æ–‡åŒ–æ‘", desc:"å°‹æ‰¾å°ç‹å­", mapQuery:"Gamcheon Culture Village", isEditing:false}, 
                            {time:"13:00", title:"BIFFå»£å ´", desc:"åƒå…ƒç¥–é»‘ç³–é¤…", mapQuery:"BIFF Square", isEditing:false},
                            {time:"15:00", title:"æ¨‚å¤©è¶…å¸‚", desc:"å…‰å¾©åº—ï¼Œé ‚æ¨“æœ‰è§€æ™¯å°", mapQuery:"Lotte Mart Gwangbok", isEditing:false}
                        ]
                    },
                    {
                        day:5, date:"11/17(äºŒ)", title:"å¿«æ¨‚è¿”å®¶", 
                        events:[
                            {time:"11:00", title:"å‰å¾€æ©Ÿå ´", desc:"è¾¦ç†é€€ç¨…ã€é€›å…ç¨…åº—", mapQuery:"Gimhae Airport", isEditing:false}
                        ]
                    }
                ]);

                // 3. å¿«æ¨‚ (Joy) - æ¯é¡ 5 å®¶
                const activeJoyCat = ref('food');
                const joyCategories = [
                    {id:'food', name:'ç¾é£Ÿ', icon:'ri-restaurant-2-fill'}, 
                    {id:'cafe', name:'å’–å•¡', icon:'ri-cup-fill'}, 
                    {id:'shop', name:'è³¼ç‰©', icon:'ri-shopping-bag-3-fill'}, 
                    {id:'snack', name:'å°åƒ', icon:'ri-cake-3-fill'}
                ];
                const joyData = ref({
                    food: [
                        {name:'å‘³è´Šç‹é¹½çƒ¤è‚‰', desc:'è¥¿é¢ï½œå°ˆäººä»£çƒ¤åšåˆ‡è±¬è‚‰', query:'Matchandeul Wang Sogeum Gui Seomyeon', must:true},
                        {name:'èèŸ»å®¶ (ê°œë¯¸ì§‘)', desc:'å—æµ¦ï½œè¾£ç‚’ç« é­šç‰›è…¸è¦', query:'Gaemijip Nampo'},
                        {name:'é›™èƒèƒè±¬è‚‰æ¹¯é£¯', desc:'å¤§æ·µï½œé‡œå±±å¿…åƒæ¿ƒéƒæ¹¯é ­', query:'Ssangdung-i Dwaeji Gukbap'},
                        {name:'ä¼ç­é•·çƒ¤è‚‰', desc:'æµ·é›²å°ï½œæˆ¶å¤–æ°£æ°›ä½³', query:'Obanjang'},
                        {name:'å¯†é™½è¡€è…¸è±¬è‚‰æ¹¯é£¯', desc:'æµ·é›²å°ï½œ24å°æ™‚ç‡Ÿæ¥­', query:'Milyang Sundae Dwaeji Gukbap'}
                    ],
                    cafe: [
                        {name:'Coralani', desc:'æ©Ÿå¼µï½œè¶…ç¾éšæ¢¯å¼æµ·æ™¯', query:'Coralani', must:true},
                        {name:'Render', desc:'æµ·é›²å°ï½œæ¥µç°¡é¢¨è³ªæ„Ÿå’–å•¡', query:'Render Cafe'},
                        {name:'Huinnyeoul Beach', desc:'å½±å³¶ï½œç²‰ç´…å¤•é™½æµ·æ™¯', query:'Huinnyeoul Beach'},
                        {name:'Old Mug', desc:'æ¾äº­ï½œæ£®æ—ç³»æœ¨å±‹æ°›åœ', query:'Old Mug'},
                        {name:'Momos Coffee', desc:'æº«æ³‰å ´ï½œä¸–ç•Œå† è»å’–å•¡å¸«', query:'Momos Coffee'}
                    ],
                    shop: [
                        {name:'Olive Young', desc:'è¥¿é¢/å—æµ¦ï½œç¾å¦ä¿é¤Šè£œè²¨', query:'Olive Young', must:true},
                        {name:'Gentle Monster', desc:'æ–°ä¸–ç•Œç™¾è²¨ï½œå¿…è²·å¢¨é¡', query:'Gentle Monster Busan'},
                        {name:'æ¨‚å¤©ç™¾è²¨å…‰å¾©åº—', desc:'å—æµ¦ï½œè¶…å¸‚+å™´æ³‰ç§€', query:'Lotte Department Store Gwangbok'},
                        {name:'Tamburins', desc:'æ–°ä¸–ç•Œç™¾è²¨ï½œé¦™æ°›è­·æ‰‹éœœ', query:'Tamburins Busan'},
                        {name:'Object', desc:'è¥¿é¢ï½œæ–‡å‰µå°ç‰©è²¼ç´™', query:'Object Seomyeon'}
                    ],
                    snack: [
                        {name:'å…ƒç¥–é»‘ç³–é¤…', desc:'BIFFå»£å ´ï½œæ’éšŠååº—', query:'Busan Hotteok'},
                        {name:'å¤ä¾†æ€é­šç³•', desc:'æµ·é›²å°ï½œå¤šå£å‘³é­šæ¿', query:'Goraesa Fish Cake'},
                        {name:'æå®¶è¾£ç‚’å¹´ç³•', desc:'å¯Œå¹³å¸‚å ´ï½œè˜¿è””çµ²å¹´ç³•', query:'Igane Tteokbokki'},
                        {name:'Ops Bakery', desc:'æµ·é›²å°ï½œå¿…åƒå·¨å¤§çš„æ³¡èŠ™', query:'Ops Bakery Haeundae'},
                        {name:'Egg Drop', desc:'è¥¿é¢ï½œæ»‘è›‹åå¸æ—©é¤', query:'Egg Drop Seomyeon'}
                    ]
                });

                // 4. è¨˜å¸³
                const activeBudgetTab = ref('public');
                const newItemName = ref('');
                const newItemPrice = ref('');
                const publicExpenses = ref([]);
                const user1Expenses = ref([]);
                const user2Expenses = ref([]);

                // 5. è³‡è¨Š (Info)
                const translations = [
                    {zh:'ä½ å¥½', kr:'ì•ˆë…•í•˜ì„¸ìš”'}, {zh:'è¬è¬', kr:'ê°ì‚¬í•©ë‹ˆë‹¤'},
                    {zh:'å¤šå°‘éŒ¢?', kr:'ì–¼ë§ˆì˜ˆìš”?'}, {zh:'è«‹çµ¦æˆ‘é€™å€‹', kr:'ì´ê±° ì£¼ì„¸ìš”'},
                    {zh:'å»æ‰€?', kr:'í™”ì¥ì‹¤?'}, {zh:'å¤ªè²´äº†', kr:'ë„ˆë¬´ ë¹„ì‹¸ìš”'},
                    {zh:'å¯ä»¥åˆ·å¡å—?', kr:'ì¹´ë“œ ë¼ìš”?'}
                ];

                // 6. è¡Œææ¸…å–® (å¯ç·¨è¼¯)
                const activeChecklistTab = ref('user1');
                const user1Packing = ref([{text:'è­·ç…§',done:false}, {text:'è½‰æ¥é ­',done:false}, {text:'ç‰™åˆ·',done:false}]);
                const user2Packing = ref([{text:'è­·ç…§',done:false}, {text:'é›¢å­å¤¾',done:false}, {text:'åŒ–å¦åŒ…',done:false}]);
                const newCheckItem = ref('');

                // --- è¨ˆç®—å±¬æ€§ ---
                const currentBudgetList = computed(() => {
                    if(activeBudgetTab.value === 'public') return publicExpenses.value;
                    return activeBudgetTab.value === 'user1' ? user1Expenses.value : user2Expenses.value;
                });
                
                const publicTotal = computed(() => publicExpenses.value.reduce((s,i)=>s+Number(i.price),0));
                
                const currentChecklist = computed(() => activeChecklistTab.value === 'user1' ? user1Packing.value : user2Packing.value);

                // --- æ–¹æ³• ---

                // åŒ¯ç‡ API
                const fetchRate = () => {
                    fetch('https://api.exchangerate-api.com/v4/latest/KRW')
                        .then(res => res.json())
                        .then(data => {
                            exchangeRate.value = data.rates.TWD;
                            alert("åŒ¯ç‡å·²æ›´æ–°ï¼ 1 KRW = " + data.rates.TWD + " TWD");
                        })
                        .catch(() => alert("ç„¡æ³•å–å¾—åŒ¯ç‡ï¼Œè«‹æª¢æŸ¥ç¶²è·¯"));
                };

                // è¡Œç¨‹ç·¨è¼¯é‚è¼¯
                const moveEvent = (idx, direction) => {
                    const list = itinerary.value[activeDayIndex.value].events;
                    const newIdx = idx + direction;
                    if(newIdx >= 0 && newIdx < list.length) {
                        [list[idx], list[newIdx]] = [list[newIdx], list[idx]];
                    }
                };
                const deleteEvent = (idx) => {
                    if(confirm("ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ")) itinerary.value[activeDayIndex.value].events.splice(idx, 1);
                };
                const addEvent = () => {
                    if(newEvent.value.title) {
                        itinerary.value[activeDayIndex.value].events.push({...newEvent.value, isEditing:false});
                        newEvent.value = {time:'', title:'', desc:'', mapQuery:''};
                        addEventModal.value = false;
                    }
                };

                // ç¿»è­¯åŠŸèƒ½
                const speak = (text) => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ko-KR';
                    window.speechSynthesis.speak(utterance);
                };
                const enlargeText = (text) => {
                    enlargeModal.value = { show: true, text: text };
                };

                // è¡Œææ¸…å–®åŠŸèƒ½
                const addCheckItem = () => {
                    if(newCheckItem.value) {
                        currentChecklist.value.push({text:newCheckItem.value, done:false});
                        newCheckItem.value = '';
                    }
                };
                const deleteCheckItem = (idx) => currentChecklist.value.splice(idx, 1);
                const toggleCheck = (idx) => currentChecklist.value[idx].done = !currentChecklist.value[idx].done;

                // å­˜å–é‚è¼¯ (ä½¿ç”¨æ–° Key ç¢ºä¿ä¹¾æ·¨)
                const saveData = () => {
                    const data = {
                        u1: user1Name.value, u2: user2Name.value, rate: exchangeRate.value,
                        prep: prepList.value, itin: itinerary.value,
                        pub: publicExpenses.value, u1e: user1Expenses.value, u2e: user2Expenses.value,
                        u1p: user1Packing.value, u2p: user2Packing.value
                    };
                    localStorage.setItem('busan_2026_final_v2', JSON.stringify(data));
                };

                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('busan_2026_final_v2');
                        if(saved) {
                            const d = JSON.parse(saved);
                            if(d.u1) user1Name.value = d.u1;
                            if(d.u2) user2Name.value = d.u2;
                            if(d.rate) exchangeRate.value = d.rate;
                            if(d.prep) prepList.value = d.prep;
                            if(d.itin) itinerary.value = d.itin;
                            if(d.pub) publicExpenses.value = d.pub;
                            if(d.u1e) user1Expenses.value = d.u1e;
                            if(d.u2e) user2Expenses.value = d.u2e;
                            if(d.u1p) user1Packing.value = d.u1p;
                            if(d.u2p) user2Packing.value = d.u2p;
                        } else {
                            fetchRate(); // é¦–æ¬¡è¼‰å…¥æŠ“åŒ¯ç‡
                        }
                    } catch(e) {}
                };

                // CRUD Helper
                const addPrep = () => { if(newPrepItem.value){ prepList.value.push({text:newPrepItem.value, done:false}); newPrepItem.value=''; }};
                const deletePrep = (i) => prepList.value.splice(i,1);
                const addItem = () => { if(newItemName.value && newItemPrice.value){ currentBudgetList.value.push({name:newItemName.value, price:newItemPrice.value}); newItemName.value=''; newItemPrice.value=''; }};
                const deleteItem = (i) => currentBudgetList.value.splice(i,1);

                // Export/Import
                const exportData = () => {
                    saveData();
                    const code = btoa(unescape(encodeURIComponent(JSON.stringify(localStorage.getItem('busan_2026_final_v2')))));
                    navigator.clipboard.writeText(code).then(()=>alert("ä»£ç¢¼å·²è¤‡è£½ï¼"));
                };
                const processImport = () => {
                    try {
                        const json = decodeURIComponent(escape(atob(importCode.value)));
                        localStorage.setItem('busan_2026_final_v2', JSON.parse(json));
                        location.reload();
                    } catch(e){ alert("ä»£ç¢¼éŒ¯èª¤"); }
                };

                const openMap = (q) => window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(q)}`, '_blank');
                const enterApp = () => showWelcomePage.value = false;

                watch([user1Name, user2Name, exchangeRate, prepList, itinerary, publicExpenses, user1Expenses, user2Expenses, user1Packing, user2Packing], saveData, {deep:true});

                onMounted(() => {
                    loadData();
                    const diff = new Date("2026-11-13").getTime() - new Date().getTime();
                    daysLeft.value = Math.max(0, Math.floor(diff/(1000*60*60*24)));
                });

                return {
                    showWelcomePage, enterApp, currentTab, importCode, processImport, exportData,
                    user1Name, user2Name, exchangeRate, daysLeft, fetchRate,
                    prepList, addPrep, deletePrep, newPrepItem,
                    itinerary, activeDayIndex, openMap, moveEvent, deleteEvent, addEvent, addEventModal, newEvent,
                    joyCategories, activeJoyCat, joyData,
                    activeBudgetTab, newItemName, newItemPrice, addItem, deleteItem, currentBudgetList, publicTotal,
                    translations, activeChecklistTab, currentChecklist, toggleCheck, newCheckItem, addCheckItem, deleteCheckItem,
                    speak, enlargeText, enlargeModal
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
