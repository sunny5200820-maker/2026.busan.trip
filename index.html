<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é‡œå±±èŠ±ç«ä¹‹æ—…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* --- å…¨åŸŸèƒŒæ™¯ (é‡œå±±å¤¢å¹»æ¼¸å±¤) --- */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            /* é è¨­èƒŒæ™¯ï¼šæŸ”å’Œçš„ç´«ç²‰æ¼¸å±¤ (Lavender Sunset) */
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            background-attachment: fixed;
            color: #334155;
            min-height: 100vh;
        }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- ç»ç’ƒæ“¬æ…‹å…ƒä»¶ --- */
        .glass-nav { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px); 
            border-top: 1px solid rgba(255, 255, 255, 0.6); 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
        }

        .input-clean { 
            background: rgba(255, 255, 255, 0.6) !important; 
            border: 1px solid rgba(255,255,255,0.6); 
            outline: none; padding: 10px 12px; border-radius: 10px; width: 100%; font-size: 14px; color: #475569; 
        }
        .input-clean:focus { background: #fff !important; border-color: #d8b4fe; box-shadow: 0 0 0 3px rgba(216, 180, 254, 0.2); }

        .header-gradient { 
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.85) 0%, rgba(236, 72, 153, 0.85) 100%);
            backdrop-filter: blur(5px);
            box-shadow: 0 10px 30px -10px rgba(168, 85, 247, 0.4);
        }

        .floating-home-btn { 
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            box-shadow: 0 10px 25px -5px rgba(161, 140, 209, 0.6); 
            transform: translateY(-24px); 
            border: 2px solid white;
        }

        /* ç‹€æ…‹æ¨£å¼ */
        .tab-active { background-color: #9333ea !important; color: white !important; box-shadow: 0 4px 6px -1px rgba(147, 51, 234, 0.3); }
        .tab-inactive { background-color: rgba(255,255,255,0.5); color: #64748b; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen pb-28 relative overflow-x-hidden" v-cloak>
        
        <div v-if="showWelcomePage" @click="enterApp" 
             class="fixed inset-0 z-[100] bg-cover bg-center cursor-pointer transition-opacity duration-700 ease-out flex flex-col justify-end items-center pb-12"
             style="background-image: url('./welcome.jpg'); background-color: #4c1d95;">
             
             <div class="animate-bounce">
                <span class="text-white text-sm font-medium tracking-widest bg-white/20 px-6 py-2.5 rounded-full backdrop-blur-md border border-white/40 shadow-lg">
                    âœ¨ é»æ“Šè¢å¹•é–‹å§‹æ—…ç¨‹ âœ¨
                </span>
             </div>
        </div>

        <div v-else class="animate-fade-up">
            
            <header class="header-gradient text-white pt-14 pb-12 px-6 rounded-b-[2.5rem] relative overflow-hidden mb-[-2rem]">
                <button @click="backToWelcome" class="absolute top-6 left-6 z-20 text-white/90 hover:text-white transition-colors p-2 bg-white/20 rounded-full backdrop-blur-md border border-white/20">
                    <i class="ri-arrow-left-s-line text-xl"></i>
                </button>

                <div class="absolute top-0 left-0 w-full h-full opacity-30 pointer-events-none">
                    <div class="absolute top-10 right-10 text-6xl animate-pulse">âœ¨</div>
                    <div class="absolute bottom-10 left-10 text-4xl">ğŸ†</div>
                </div>
                <div class="relative z-10 text-center">
                    <div class="flex justify-center items-center gap-2 mb-2 opacity-95">
                        <p class="text-xs tracking-[0.2em] uppercase font-bold text-white/90">Busan 2026</p>
                        <button @click="editDate" class="text-xs border border-white/40 px-2.5 py-1 rounded-full hover:bg-white/20 transition-colors backdrop-blur-sm"><i class="ri-settings-3-line"></i> è¨­å®šæ—¥æœŸ</button>
                    </div>
                    <h1 class="text-3xl font-bold mb-6 tracking-wide drop-shadow-md">
                        é‡œå±±èŠ±ç«ç¯€<br>æ…¢æ´»å¥¢è¯æ—…
                    </h1>
                    <div class="inline-flex items-center justify-center gap-6 py-3 px-8 bg-white/20 backdrop-blur-md rounded-full border border-white/30 shadow-[0_4px_20px_rgba(0,0,0,0.1)]">
                        <div class="text-center">
                            <span class="block text-2xl font-bold font-mono text-yellow-200">{{ daysLeft }}</span>
                            <span class="text-[10px] opacity-90 uppercase">Days</span>
                        </div>
                        <div class="h-8 w-px bg-white/40"></div>
                        <div class="text-center">
                            <span class="block text-2xl font-bold font-mono text-pink-200">{{ hoursLeft }}</span>
                            <span class="text-[10px] opacity-90 uppercase">Hrs</span>
                        </div>
                    </div>
                </div>
            </header>

            <div v-if="currentTab === 'home'" class="px-5 relative z-20">
                <div class="bg-white p-6 rounded-3xl shadow-sm mb-4" style="background-color: rgba(255,255,255,0.7) !important;">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-purple-100 text-purple-600 p-2 rounded-xl"><i class="ri-list-check text-lg"></i></div>
                        <h3 class="font-bold text-lg text-slate-700">è¡Œå‰æº–å‚™</h3>
                    </div>
                    <div class="space-y-2 mb-4">
                        <div v-for="(item, idx) in prepList" :key="idx" class="flex items-center justify-between p-3 hover:bg-purple-50 rounded-xl group transition-colors border border-transparent cursor-pointer" @click="item.done = !item.done">
                            <div class="flex items-center gap-3 flex-1">
                                <div :class="`w-5 h-5 rounded-full flex items-center justify-center border transition-all ${item.done ? 'bg-purple-500 border-purple-500 scale-110' : 'border-purple-200 bg-white'}`">
                                    <i v-if="item.done" class="ri-check-line text-white text-xs"></i>
                                </div>
                                <span :class="`text-sm font-medium transition-colors ${item.done ? 'line-through text-gray-400' : 'text-slate-600'}`">{{ item.text }}</span>
                            </div>
                            <button @click.stop="deletePrep(idx)" class="text-gray-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    </div>
                    <div class="flex gap-2 pt-3 border-t border-gray-100">
                        <input v-model="newPrepItem" placeholder="æ–°å¢å¾…è¾¦..." class="input-clean" @keyup.enter="addPrep">
                        <button @click="addPrep" class="bg-purple-500 hover:bg-purple-600 text-white px-3.5 rounded-xl transition-colors shadow-sm shadow-purple-200"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'schedule'" class="px-4 pt-8">
                <div class="flex overflow-x-auto space-x-3 pb-4 no-scrollbar px-1">
                    <button v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                        :class="`flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap border shadow-sm
                        ${activeDayIndex === index ? 'bg-purple-600 text-white border-purple-600 shadow-purple-200' : 'bg-white text-slate-500 border-white hover:bg-white/80'}`">
                        Day {{ day.day }}
                    </button>
                </div>

                <div class="bg-white rounded-3xl p-6 min-h-[50vh] animate-fade-up" style="background-color: rgba(255,255,255,0.8) !important;">
                    <div class="flex justify-between items-end mb-6 border-b border-gray-100 pb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">Day {{ itinerary[activeDayIndex].day }}</h2>
                            <p class="text-sm text-purple-500 font-bold mt-1">{{ itinerary[activeDayIndex].date }}</p>
                        </div>
                        <button @click="editDayTitle" class="text-xs text-slate-400 bg-gray-50 px-3 py-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                            {{ itinerary[activeDayIndex].title }} <i class="ri-edit-line ml-1"></i>
                        </button>
                    </div>

                    <div class="space-y-8 relative pl-2 ml-2 border-l-2 border-gray-100">
                        <div v-for="(event, idx) in itinerary[activeDayIndex].events" :key="idx" class="relative pl-6 group">
                            <div :class="`absolute -left-[9px] top-1.5 w-4 h-4 rounded-full border-[3px] border-white shadow-md z-10
                                ${event.isImportant ? 'bg-pink-500 ring-2 ring-pink-100' : 'bg-indigo-400'}`">
                            </div>
                            
                            <div class="relative">
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs font-mono font-bold text-slate-400 bg-gray-50 px-2 py-0.5 rounded">{{ event.time }}</span>
                                    </div>
                                    <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button v-if="idx > 0" @click="moveEvent(activeDayIndex, idx, -1)" class="p-1 text-gray-400 hover:text-purple-600 bg-gray-50 rounded hover:bg-purple-50"><i class="ri-arrow-up-s-line"></i></button>
                                        <button v-if="idx < itinerary[activeDayIndex].events.length - 1" @click="moveEvent(activeDayIndex, idx, 1)" class="p-1 text-gray-400 hover:text-purple-600 bg-gray-50 rounded hover:bg-purple-50"><i class="ri-arrow-down-s-line"></i></button>
                                        <button @click="deleteEvent(activeDayIndex, idx)" class="p-1 text-gray-300 hover:text-red-500 bg-gray-50 rounded hover:bg-red-50 ml-1"><i class="ri-close-line"></i></button>
                                    </div>
                                </div>
                                <h4 class="font-bold text-slate-800 text-lg">{{ event.title }}</h4>
                                <p class="text-sm text-slate-500 leading-relaxed mb-3">{{ event.desc }}</p>
                                
                                <button v-if="event.mapQuery" @click="openMap(event.mapQuery)" 
                                    class="inline-flex items-center gap-1 text-xs font-bold text-white bg-[#03C75A] px-3 py-1.5 rounded-lg hover:bg-[#02b351] transition-colors shadow-sm shadow-green-100">
                                    <i class="ri-map-pin-2-fill"></i> Naver Map
                                </button>
                            </div>
                        </div>

                        <div class="pl-6 pt-4">
                            <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 border-dashed hover:bg-slate-100 transition-colors">
                                <p class="text-xs text-slate-400 mb-3 font-bold flex items-center gap-1"><i class="ri-add-circle-line"></i> æ–°å¢è¡Œç¨‹</p>
                                <div class="grid grid-cols-4 gap-2 mb-2">
                                    <input v-model="newEvent.time" placeholder="æ™‚é–“" class="col-span-1 input-clean bg-white !important">
                                    <input v-model="newEvent.title" placeholder="æ¨™é¡Œ" class="col-span-3 input-clean bg-white !important">
                                </div>
                                <input v-model="newEvent.desc" placeholder="å‚™è¨»" class="input-clean bg-white !important mb-2">
                                <input v-model="newEvent.mapQuery" placeholder="åœ°åœ–é—œéµå­— (é¸å¡«)" class="input-clean bg-white !important mb-2">
                                <button @click="addEvent" class="w-full bg-purple-600 hover:bg-purple-700 text-white rounded-xl py-2.5 text-sm font-bold transition-colors shadow-sm shadow-purple-200">åŠ å…¥</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="px-5 pt-8 space-y-6">
                <div class="bg-white rounded-3xl p-5 shadow-sm" style="background-color: rgba(255,255,255,0.8) !important;">
                    <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="ri-hotel-fill text-purple-500"></i> ä½å®¿è³‡è¨Š</h2>
                    <div class="grid gap-4">
                        <div v-for="(hotel, idx) in infoList" :key="idx" class="bg-white rounded-2xl p-4 border border-gray-100 relative group shadow-sm">
                            <button @click="deleteInfo(idx)" class="absolute top-3 right-3 text-gray-300 hover:text-red-400"><i class="ri-delete-bin-line"></i></button>
                            <h3 class="font-bold text-slate-800">{{ hotel.name }}</h3>
                            <p class="text-sm text-slate-500 mt-1">{{ hotel.desc }}</p>
                            <span class="inline-block mt-2 text-[10px] bg-pink-50 text-pink-500 px-2 py-1 rounded">{{ hotel.tag }}</span>
                            <div class="mt-3 flex gap-2">
                                <button @click="openMap(hotel.name)" class="flex-1 bg-gray-50 py-2 rounded-lg text-xs font-bold text-slate-600">å°èˆª</button>
                            </div>
                        </div>
                        <div class="bg-gray-50 border-2 border-dashed border-gray-200 rounded-2xl p-4">
                            <input v-model="newInfo.name" placeholder="ä½å®¿åç¨±" class="input-clean mb-2 bg-white !important">
                            <div class="flex gap-2">
                                <input v-model="newInfo.tag" placeholder="å‚™è¨»" class="input-clean bg-white !important">
                                <button @click="addInfo" class="bg-purple-600 text-white px-4 rounded-lg">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="px-5 pt-8 pb-20 space-y-6">
                <div class="bg-gradient-to-r from-slate-700 to-slate-800 rounded-3xl p-6 text-white shadow-xl shadow-slate-300 relative overflow-hidden">
                    <p class="text-xs text-slate-300 mb-1 font-medium">{{ activeBudgetTab === 'public' ? 'å…¬å¸³ç¸½æ”¯å‡º' : 'å€‹äººæ”¯å‡º' }} (TWD)</p>
                    <h2 class="text-4xl font-bold font-mono tracking-tight">${{ Math.round(currentTotal * 0.024).toLocaleString() }}</h2>
                    <p class="text-sm text-slate-400 mt-2 font-mono">â‰ˆ â‚©{{ currentTotal.toLocaleString() }} KRW</p>
                </div>

                <div class="bg-white rounded-3xl p-5" style="background-color: rgba(255,255,255,0.8) !important;">
                    <div class="flex gap-2 mb-4 bg-gray-100 p-1 rounded-2xl">
                        <button @click="activeBudgetTab = 'public'" :class="`flex-1 py-2 rounded-xl text-xs font-bold transition-all ${activeBudgetTab === 'public' ? 'tab-active' : 'tab-inactive'}`">ğŸ’° å…¬å¸³</button>
                        <button @click="activeBudgetTab = 'me'" :class="`flex-1 py-2 rounded-xl text-xs font-bold transition-all ${activeBudgetTab === 'me' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¤ æˆ‘</button>
                        <button @click="activeBudgetTab = 'partner'" :class="`flex-1 py-2 rounded-xl text-xs font-bold transition-all ${activeBudgetTab === 'partner' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¥ æ—…ä¼´</button>
                    </div>

                    <div v-if="activeBudgetTab === 'public'" class="mb-4 bg-purple-50 border border-purple-100 rounded-xl p-3 flex justify-between items-center text-sm">
                        <span class="text-purple-600 font-bold">æ¯äººæ‡‰ä»˜ (é™¤ä»¥2)</span>
                        <span class="text-purple-800 font-mono font-bold">â‚©{{ Math.round(currentTotal / 2).toLocaleString() }}</span>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input v-model="newItemName" type="text" placeholder="å“é …" class="flex-1 input-clean bg-gray-50 !important">
                        <input v-model="newItemPrice" type="number" placeholder="â‚©" class="w-28 input-clean bg-gray-50 !important">
                        <button @click="addItem" class="bg-purple-600 hover:bg-purple-700 text-white w-11 h-[42px] rounded-xl flex items-center justify-center shadow-sm"><i class="ri-add-line text-xl"></i></button>
                    </div>

                    <div class="space-y-2 max-h-[40vh] overflow-y-auto no-scrollbar pr-1">
                        <div v-for="(item, idx) in currentBudgetList" :key="idx" class="flex justify-between items-center text-sm p-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors group">
                            <span class="text-slate-700 font-medium">{{ item.name }}</span>
                            <div class="flex items-center gap-3">
                                <span class="font-mono text-slate-500">â‚©{{ item.price }}</span>
                                <button @click="deleteItem(idx)" class="text-gray-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all"><i class="ri-close-circle-fill text-lg"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-3xl p-5" style="background-color: rgba(255,255,255,0.8) !important;">
                    <h3 class="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2"><i class="ri-arrow-left-right-line"></i> è³‡æ–™å‚³è¼¸ (åŒæ­¥)</h3>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button @click="exportData" class="flex items-center justify-center gap-2 bg-blue-50 text-blue-600 py-3 rounded-xl text-sm font-bold hover:bg-blue-100">
                            <i class="ri-upload-cloud-2-line"></i> åŒ¯å‡ºä»£ç¢¼
                        </button>
                        <button @click="importData" class="flex items-center justify-center gap-2 bg-green-50 text-green-600 py-3 rounded-xl text-sm font-bold hover:bg-green-100">
                            <i class="ri-download-cloud-2-line"></i> åŒ¯å…¥ä»£ç¢¼
                        </button>
                    </div>
                    <div class="text-center border-t border-gray-100 pt-3">
                        <button @click="resetData" class="text-xs text-red-400 hover:text-red-600 flex items-center justify-center gap-1 mx-auto">
                            <i class="ri-refresh-line"></i> åˆªé™¤æ‰€æœ‰è³‡æ–™é‡ä¾†
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'checklist'" class="px-5 pt-8 space-y-4">
                <h2 class="text-lg font-bold text-slate-800 mb-2">è¡Œææ¸…å–®</h2>
                <div class="flex gap-2 mb-4 bg-white/50 p-1 rounded-2xl backdrop-blur-sm">
                    <button @click="activeChecklistTab = 'me'" :class="`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${activeChecklistTab === 'me' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¤ æˆ‘çš„è¡Œæ</button>
                    <button @click="activeChecklistTab = 'partner'" :class="`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${activeChecklistTab === 'partner' ? 'tab-active' : 'tab-inactive'}`">ğŸ‘¥ æ—…ä¼´è¡Œæ</button>
                </div>
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm min-h-[50vh]" style="background-color: rgba(255,255,255,0.8) !important;">
                    <div v-for="(item, idx) in currentChecklist" :key="idx" @click="toggleCheck(idx)" class="flex items-center p-4 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors cursor-pointer group">
                        <div :class="`w-6 h-6 rounded-lg border flex items-center justify-center mr-4 transition-all ${item.done ? 'bg-purple-500 border-purple-500 scale-105' : 'border-gray-300 group-hover:border-purple-300'}`">
                            <i v-if="item.done" class="ri-check-line text-white text-sm"></i>
                        </div>
                        <span :class="`text-sm font-medium flex-1 transition-colors ${item.done ? 'text-gray-300 line-through' : 'text-slate-600'}`">{{ item.text }}</span>
                    </div>
                </div>
            </div>

        </div>

        <nav v-if="!showWelcomePage" class="fixed bottom-0 left-0 right-0 glass-nav z-50 pb-safe">
            <div class="grid grid-cols-5 items-end h-16 max-w-md mx-auto relative">
                <button @click="currentTab = 'schedule'" class="flex flex-col items-center justify-center h-full pb-1 group">
                    <i :class="`text-xl mb-1 transition-colors ${currentTab === 'schedule' ? 'ri-calendar-event-fill text-purple-500' : 'ri-calendar-line text-slate-400 group-hover:text-purple-400'}`"></i>
                    <span :class="`text-[10px] font-medium transition-colors ${currentTab === 'schedule' ? 'text-purple-500' : 'text-slate-400 group-hover:text-purple-400'}`">è¡Œç¨‹</span>
                </button>
                <button @click="currentTab = 'info'" class="flex flex-col items-center justify-center h-full pb-1 group">
                    <i :class="`text-xl mb-1 transition-colors ${currentTab === 'info' ? 'ri-hotel-fill text-purple-500' : 'ri-hotel-line text-slate-400 group-hover:text-purple-400'}`"></i>
                    <span :class="`text-[10px] font-medium transition-colors ${currentTab === 'info' ? 'text-purple-500' : 'text-slate-400 group-hover:text-purple-400'}`">è³‡è¨Š</span>
                </button>
                <div class="relative flex justify-center h-full">
                    <button @click="currentTab = 'home'" class="absolute -top-6 w-14 h-14 rounded-full floating-home-btn active:scale-95 transition-transform flex items-center justify-center shadow-lg shadow-purple-200">
                        <i class="ri-home-4-fill text-2xl text-white"></i>
                    </button>
                    <span :class="`absolute bottom-1 text-[10px] font-medium transition-colors ${currentTab === 'home' ? 'text-purple-500' : 'text-slate-400'}`">é¦–é </span>
                </div>
                <button @click="currentTab = 'budget'" class="flex flex-col items-center justify-center h-full pb-1 group">
                    <i :class="`text-xl mb-1 transition-colors ${currentTab === 'budget' ? 'ri-wallet-3-fill text-purple-500' : 'ri-wallet-3-line text-slate-400 group-hover:text-purple-400'}`"></i>
                    <span :class="`text-[10px] font-medium transition-colors ${currentTab === 'budget' ? 'text-purple-500' : 'text-slate-400 group-hover:text-purple-400'}`">è¨˜å¸³</span>
                </button>
                <button @click="currentTab = 'checklist'" class="flex flex-col items-center justify-center h-full pb-1 group">
                    <i :class="`text-xl mb-1 transition-colors ${currentTab === 'checklist' ? 'ri-checkbox-multiple-fill text-purple-500' : 'ri-checkbox-multiple-line text-slate-400 group-hover:text-purple-400'}`"></i>
                    <span :class="`text-[10px] font-medium transition-colors ${currentTab === 'checklist' ? 'text-purple-500' : 'text-slate-400 group-hover:text-purple-400'}`">æ¸…å–®</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const showWelcomePage = ref(true);
                const currentTab = ref('home');
                const activeDayIndex = ref(0);
                const activeBudgetTab = ref('public'); 
                const activeChecklistTab = ref('me'); 

                const defaultDate = "2026-11-13T14:30:00";
                const targetDate = ref(defaultDate);
                const daysLeft = ref(0);
                const hoursLeft = ref(0);
                
                // è¡Œå‰æº–å‚™
                const prepList = ref([
                    { text: 'é è¨‚æ©Ÿç¥¨ (å°šæœªé–‹è³£)', done: false },
                    { text: 'é è¨‚ä½å®¿', done: false },
                    { text: 'é ç´„è† å›Šåˆ—è»Š', done: false },
                    { text: 'ä¸‹è¼‰ Kakao T', done: false }
                ]);
                const newPrepItem = ref('');

                // ä½å®¿è³‡è¨Š
                const infoList = ref([
                    { name: 'å»£å®‰é‡Œ Hotel 1', desc: 'æµ·æ™¯ç¬¬ä¸€æ’', tag: 'Day 1-2' },
                    { name: 'è¥¿é¢ Arban Hotel', desc: 'äº¤é€šæ–¹ä¾¿', tag: 'Day 3-4' }
                ]);
                const newInfo = ref({ name: '', desc: '', tag: '' });

                // è¡Œç¨‹è³‡æ–™ (ç°¡åŒ–ç¯„ä¾‹)
                const itinerary = ref([
                    { day: 1, date: "11/13 (äº”)", title: "æŠµé”", events: [ { time: "14:30", title: "æ©Ÿå ´æŠµé”", desc: "é ˜å– WOWPASS", mapQuery: "Gimhae Airport" }, { time: "18:00", title: "å‘³è´Šç‹é¹½çƒ¤è‚‰", desc: "æ™šé¤", mapQuery: "Matchandeul" } ] },
                    { day: 2, date: "11/14 (å…­)", title: "ç…™ç«", events: [ { time: "11:00", title: "è† å›Šåˆ—è»Š", desc: "å°¾æµ¦å‡ºç™¼", mapQuery: "Mipo Station" }, { time: "20:00", title: "é‡œå±±ç…™ç«ç¯€", desc: "æˆ¿å…§è§€è³", mapQuery: "Gwangan Bridge" } ] },
                    { day: 3, date: "11/15 (æ—¥)", title: "æ…¶å·", events: [ { time: "11:00", title: "å‰å¾€æ…¶å·", desc: "åŒ…è»Šä¸€æ—¥éŠ", mapQuery: "Gyeongju" }, { time: "17:30", title: "æ±å®®èˆ‡æœˆæ± ", desc: "å¤œæ™¯", mapQuery: "Donggung Palace" } ] },
                    { day: 4, date: "11/16 (ä¸€)", title: "ç”˜å·", events: [ { time: "11:00", title: "ç”˜å·æ´æ–‡åŒ–æ‘", desc: "å°ç‹å­åˆç…§", mapQuery: "Gamcheon Culture Village" }, { time: "15:00", title: "å—æµ¦æ´", desc: "æ¨‚å¤©è¶…å¸‚", mapQuery: "Lotte Mart Gwangbok" } ] },
                    { day: 5, date: "11/17 (äºŒ)", title: "è¿”ç¨‹", events: [ { time: "11:00", title: "æ©Ÿå ´å…ç¨…åº—", desc: "æœ€å¾Œè£œè²¨", mapQuery: "Gimhae Airport" } ] }
                ]);
                const newEvent = ref({ time: '', title: '', desc: '', mapQuery: '' });

                // è¨˜å¸³èˆ‡æ¸…å–®
                const publicExpenses = ref([]);
                const myExpenses = ref([]);
                const partnerExpenses = ref([]);
                const newItemName = ref('');
                const newItemPrice = ref('');

                const myPackingList = ref([{ text: 'è­·ç…§', done: false }, { text: 'è½‰æ¥é ­', done: false }, { text: 'ç‰™åˆ·', done: false }]);
                const partnerPackingList = ref([{ text: 'è­·ç…§', done: false }, { text: 'è½‰æ¥é ­', done: false }, { text: 'ç‰™åˆ·', done: false }]);

                // --- å­˜æª”èˆ‡è®€æª” (å«é˜²å´©æ½°) ---
                const saveData = () => {
                    const data = {
                        targetDate: targetDate.value,
                        prepList: prepList.value,
                        infoList: infoList.value,
                        itinerary: itinerary.value,
                        publicExpenses: publicExpenses.value,
                        myExpenses: myExpenses.value,
                        partnerExpenses: partnerExpenses.value,
                        myPackingList: myPackingList.value,
                        partnerPackingList: partnerPackingList.value
                    };
                    localStorage.setItem('busan_v9_data', JSON.stringify(data));
                };

                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('busan_v9_data');
                        if (saved) {
                            const data = JSON.parse(saved);
                            if(data.targetDate) targetDate.value = data.targetDate;
                            if(data.prepList) prepList.value = data.prepList;
                            if(data.infoList) infoList.value = data.infoList;
                            if(data.itinerary) itinerary.value = data.itinerary;
                            if(data.publicExpenses) publicExpenses.value = data.publicExpenses;
                            if(data.myExpenses) myExpenses.value = data.myExpenses;
                            if(data.partnerExpenses) partnerExpenses.value = data.partnerExpenses;
                            if(data.myPackingList) myPackingList.value = data.myPackingList;
                            if(data.partnerPackingList) partnerPackingList.value = data.partnerPackingList;
                        }
                    } catch (e) {
                        console.error("è³‡æ–™è®€å–éŒ¯èª¤ï¼Œå·²é‡ç½®", e);
                        // å¦‚æœè®€å–å¤±æ•—ï¼Œä¸åšä»»ä½•äº‹ï¼Œä½¿ç”¨é è¨­å€¼ï¼Œé¿å…ç™½ç•«é¢
                    }
                };

                watch([targetDate, prepList, infoList, itinerary, publicExpenses, myExpenses, partnerExpenses, myPackingList, partnerPackingList], saveData, { deep: true });

                // --- åŠŸèƒ½å‡½å¼ ---
                const calculateCountdown = () => {
                    const now = new Date().getTime();
                    const target = new Date(targetDate.value).getTime();
                    const diff = target - now;
                    if (diff > 0) {
                        daysLeft.value = Math.floor(diff / (1000 * 60 * 60 * 24));
                        hoursLeft.value = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    }
                };
                
                // è¡Œç¨‹æ’åº
                const moveEvent = (dayIdx, eventIdx, direction) => {
                    const events = itinerary.value[dayIdx].events;
                    const newIndex = eventIdx + direction;
                    if (newIndex >= 0 && newIndex < events.length) {
                        [events[eventIdx], events[newIndex]] = [events[newIndex], events[eventIdx]];
                    }
                };

                // åŒ¯å‡ºåŒ¯å…¥
                const exportData = () => {
                    const dataStr = JSON.stringify(localStorage.getItem('busan_v9_data'));
                    const encoded = btoa(unescape(encodeURIComponent(dataStr))); 
                    navigator.clipboard.writeText(encoded).then(() => alert("âœ… ä»£ç¢¼å·²è¤‡è£½ï¼è«‹å‚³çµ¦æ—…ä¼´ã€‚"));
                };
                const importData = () => {
                    const input = prompt("è«‹è²¼ä¸Šä»£ç¢¼ï¼š");
                    if(input) {
                        try {
                            const decoded = decodeURIComponent(escape(atob(input)));
                            const jsonStr = JSON.parse(decoded); 
                            localStorage.setItem('busan_v9_data', jsonStr);
                            location.reload(); // å¼·åˆ¶é‡æ•´ä»¥è®€å–æ–°è³‡æ–™
                        } catch(e) { alert("âŒ ä»£ç¢¼éŒ¯èª¤"); }
                    }
                };
                const resetData = () => {
                    if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿè³‡æ–™å°‡å…¨éƒ¨æ¸…é™¤ï¼")) {
                        localStorage.removeItem('busan_v9_data');
                        location.reload();
                    }
                };

                // Helper functions
                const enterApp = () => showWelcomePage.value = false;
                const backToWelcome = () => showWelcomePage.value = true;
                const editDate = () => {
                    const d = prompt("è¼¸å…¥æ—¥æœŸ YYYY-MM-DD", targetDate.value.split('T')[0]);
                    if(d) targetDate.value = d + "T14:30:00";
                    calculateCountdown();
                };
                const addPrep = () => { if(newPrepItem.value) { prepList.value.push({text: newPrepItem.value, done:false}); newPrepItem.value=''; }};
                const deletePrep = (i) => prepList.value.splice(i,1);
                const addInfo = () => { if(newInfo.value.name) { infoList.value.push({...newInfo.value}); newInfo.value={name:'',desc:'',tag:''}; }};
                const deleteInfo = (i) => infoList.value.splice(i,1);
                const editDayTitle = () => { const t = prompt("ä¿®æ”¹æ¨™é¡Œ", itinerary.value[activeDayIndex.value].title); if(t) itinerary.value[activeDayIndex.value].title=t; };
                const addEvent = () => { if(newEvent.value.title) { itinerary.value[activeDayIndex.value].events.push({...newEvent.value}); newEvent.value={time:'',title:'',desc:'',mapQuery:''}; }};
                const deleteEvent = (di, ei) => itinerary.value[di].events.splice(ei,1);
                const openMap = (q) => window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(q)}`, '_blank');

                // Computed
                const currentBudgetList = computed(() => {
                    if(activeBudgetTab.value === 'public') return publicExpenses.value;
                    if(activeBudgetTab.value === 'me') return myExpenses.value;
                    return partnerExpenses.value;
                });
                const currentTotal = computed(() => currentBudgetList.value.reduce((sum, i) => sum + Number(i.price), 0));
                const addItem = () => { if(newItemName.value && newItemPrice.value) { currentBudgetList.value.push({name:newItemName.value, price:newItemPrice.value}); newItemName.value=''; newItemPrice.value=''; }};
                const deleteItem = (i) => currentBudgetList.value.splice(i,1);
                
                const currentChecklist = computed(() => activeChecklistTab.value === 'me' ? myPackingList.value : partnerPackingList.value);
                const toggleCheck = (i) => { const l = activeChecklistTab.value === 'me' ? myPackingList.value : partnerPackingList.value; l[i].done = !l[i].done; };

                onMounted(() => {
                    loadData();
                    calculateCountdown();
                    setInterval(calculateCountdown, 60000);
                });

                return {
                    showWelcomePage, enterApp, backToWelcome, currentTab, 
                    daysLeft, hoursLeft, editDate,
                    prepList, addPrep, deletePrep, newPrepItem,
                    activeDayIndex, itinerary, editDayTitle, addEvent, deleteEvent, moveEvent, newEvent,
                    infoList, addInfo, deleteInfo, newInfo,
                    activeBudgetTab, activeChecklistTab,
                    newItemName, newItemPrice, currentBudgetList, currentTotal, addItem, deleteItem,
                    currentChecklist, toggleCheck, packingList,
                    openMap, resetData, exportData, importData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
