<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é‡œå±±èŠ±ç«ä¹‹æ—…</title>
    
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            alert("ç™¼ç”ŸéŒ¯èª¤ï¼š" + msg);
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼ */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; padding: 0;
            /* é‚„åŸåŸæœ¬çš„æ¼¸å±¤èƒŒæ™¯ */
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            background-attachment: fixed; /* èƒŒæ™¯å›ºå®šï¼Œä¸éš¨æ²å‹•è·‘æ‰ */
            color: #334155;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* æ­¡è¿é å¼·åˆ¶æ¨£å¼ (å…¨è¢å¹•åœ–ç‰‡) */
        #welcome-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #4c1d95;
            background-size: cover; background-position: center;
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 80px;
        }

        /* çµ±ä¸€çš„æ¯›ç»ç’ƒå¡ç‰‡æ¨£å¼ (å–ä»£åŸæœ¬é†œé†œçš„ç™½æ¡†) */
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* åº•éƒ¨å°èˆª */
        .glass-nav { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px); 
            border-top: 1px solid rgba(255,255,255,0.5); 
        }

        /* Vue å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* éš±è— Scrollbar ä½†ä¿ç•™åŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 90px); }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen relative">
        
        <div id="welcome-layer" v-if="showWelcomePage" :style="{ backgroundImage: `url('./welcome.jpg')` }">
            <div class="bg-black/30 absolute inset-0"></div> <div class="relative z-10 w-full px-8 text-center">
                <h1 class="text-4xl font-bold text-white mb-2 tracking-widest drop-shadow-lg">BUSAN 2026</h1>
                <p class="text-white/80 text-sm tracking-widest mb-10">HAPPY TRIP WITH DUCK & WEN</p>
                
                <button @click="enterApp" class="w-full bg-white/20 backdrop-blur-md border border-white/50 text-white py-3 rounded-full font-bold shadow-lg mb-6 hover:bg-white/30 transition-all">
                    é€²å…¥æ—…ç¨‹
                </button>

                <div class="bg-black/40 backdrop-blur-md p-4 rounded-2xl border border-white/10">
                    <div class="flex gap-2">
                        <input v-model="importCode" placeholder="åœ¨æ­¤è²¼ä¸Šè¡Œç¨‹ä»£ç¢¼..." class="flex-1 bg-white/10 border border-white/30 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-300 outline-none">
                        <button @click="processImport" class="bg-purple-500 text-white px-4 rounded-lg text-sm font-bold">åŒ¯å…¥</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-else class="max-w-md mx-auto min-h-screen flex flex-col pb-safe">
            
            <div class="flex justify-end pt-4 px-4">
                <button @click="exportData" class="glass-card px-3 py-1.5 text-white/90 text-xs font-bold flex items-center gap-1 hover:bg-white/40 transition">
                    <i class="ri-save-3-line"></i> å­˜æª”/åŒ¯å‡º
                </button>
            </div>

            <div v-if="currentTab === 'home'" class="flex-1 px-5 pt-2 flex flex-col gap-6">
                
                <div class="text-center text-white mt-4">
                    <div class="inline-block bg-white/20 backdrop-blur px-3 py-1 rounded-full text-xs font-bold mb-2 border border-white/30">
                        2026.11.13 - 11.17
                    </div>
                    <h1 class="text-3xl font-bold drop-shadow-md mb-6">é‡œå±±æ…¶å·<br>æ…¢æ´»ä¹‹æ—… ğŸ‡°ğŸ‡·</h1>
                    
                    <div class="flex justify-center gap-4">
                        <div class="glass-card p-4 w-28 flex flex-col items-center justify-center">
                            <span class="text-2xl font-bold font-mono">{{ daysLeft }}</span>
                            <span class="text-[10px] uppercase opacity-80">Days Left</span>
                        </div>
                        <div class="glass-card p-4 w-28 flex flex-col items-center justify-center">
                            <i class="ri-sun-cloudy-line text-2xl mb-1"></i>
                            <span class="text-[10px] uppercase opacity-80">12Â°C æ™´æ™‚å¤šé›²</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-5 text-slate-800">
                    <h3 class="font-bold mb-2 flex items-center gap-2"><i class="ri-t-shirt-2-line text-purple-600"></i> å»ºè­°ç©¿æ­</h3>
                    <p class="text-sm leading-relaxed opacity-80">
                        æ—©æ™šæº«å·®å¤§ (8-16Â°C)ã€‚<br>
                        æ¨è–¦ï¼šç™¼ç†±è¡£ + è–„é•·è¢– + é˜²é¢¨å¤§è¡£ã€‚
                    </p>
                </div>

                <div class="glass-card p-5">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-slate-800"><i class="ri-list-check text-purple-600"></i> å¾…è¾¦æ¸…å–®</h3>
                        <span class="text-xs bg-white/50 px-2 py-1 rounded-full text-purple-700 font-bold">{{ prepList.filter(i=>!i.done).length }} å¾…è¾¦</span>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, idx) in prepList" :key="idx" @click="item.done = !item.done" class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/30 cursor-pointer transition">
                            <i :class="item.done ? 'ri-checkbox-circle-fill text-green-500' : 'ri-checkbox-blank-circle-line text-slate-400'" class="text-xl"></i>
                            <span :class="item.done ? 'line-through text-slate-400' : 'text-slate-800'">{{ item.text }}</span>
                            <button @click.stop="deletePrep(idx)" class="ml-auto text-slate-400 hover:text-red-500"><i class="ri-close-line"></i></button>
                        </div>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <input v-model="newPrepItem" placeholder="æ–°å¢äº‹é …..." class="flex-1 bg-white/40 border-none rounded-lg px-3 py-2 text-sm outline-none placeholder-slate-500">
                        <button @click="addPrep" class="bg-purple-600 text-white w-8 h-8 rounded-lg flex items-center justify-center"><i class="ri-add-line"></i></button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'schedule'" class="flex-1 px-4 pt-4">
                <div class="flex overflow-x-auto space-x-3 pb-4 hide-scrollbar">
                    <button v-for="(day, index) in itinerary" :key="index" @click="activeDayIndex = index"
                        :class="`flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm ${activeDayIndex === index ? 'bg-purple-600 text-white' : 'glass-card text-slate-600'}`">
                        Day {{ day.day }}
                    </button>
                </div>
                
                <div class="glass-card p-6 min-h-[50vh]">
                    <div class="flex justify-between items-end mb-6 border-b border-slate-200/50 pb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">{{ itinerary[activeDayIndex].title }}</h2>
                            <p class="text-sm text-purple-700 font-bold mt-1">{{ itinerary[activeDayIndex].date }}</p>
                        </div>
                        <i v-if="itinerary[activeDayIndex].title.includes('æ…¶å·')" class="ri-ancient-gate-fill text-3xl text-slate-300"></i>
                    </div>

                    <div class="space-y-6 relative pl-4 border-l-2 border-slate-300/50 ml-1">
                        <div v-for="(event, idx) in itinerary[activeDayIndex].events" :key="idx" class="relative">
                            <div class="absolute -left-[21px] top-1.5 w-3 h-3 rounded-full bg-purple-400 ring-4 ring-white/30"></div>
                            <div class="pl-3">
                                <span class="text-xs font-mono font-bold text-slate-500 mb-1 block">{{ event.time }}</span>
                                <h4 class="font-bold text-slate-800 text-lg">{{ event.title }}</h4>
                                <p class="text-sm text-slate-600 mb-2">{{ event.desc }}</p>
                                <button v-if="event.mapQuery" @click="openMap(event.mapQuery)" class="bg-white/50 text-slate-700 text-xs px-2 py-1 rounded border border-slate-200 hover:bg-white">
                                    <i class="ri-map-pin-line"></i> åœ°åœ–
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'joy'" class="flex-1 px-5 pt-4 pb-20">
                <div class="glass-card p-4 mb-6 sticky top-2 z-20 flex justify-around">
                    <button v-for="cat in joyCategories" :key="cat.id" @click="activeJoyCat = cat.id"
                        :class="`flex flex-col items-center gap-1 text-xs font-bold transition-colors ${activeJoyCat === cat.id ? 'text-purple-700' : 'text-slate-400'}`">
                        <div :class="`w-10 h-10 rounded-full flex items-center justify-center text-lg ${activeJoyCat === cat.id ? 'bg-purple-100' : 'bg-slate-100/50'}`">
                            <i :class="cat.icon"></i>
                        </div>
                        {{ cat.name }}
                    </button>
                </div>

                <div class="space-y-4">
                    <div v-for="shop in joyData[activeJoyCat]" :key="shop.name" class="glass-card p-4 flex justify-between items-center">
                        <div>
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold text-slate-800">{{ shop.name }}</h3>
                                <span v-if="shop.must" class="text-[10px] bg-red-400 text-white px-1.5 rounded-sm">å¿…å»</span>
                            </div>
                            <p class="text-xs text-slate-600 mt-1">{{ shop.desc }}</p>
                        </div>
                        <button @click="openMap(shop.query)" class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center shadow-lg hover:scale-110 transition">
                            <i class="ri-navigation-fill"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="flex-1 px-5 pt-4 pb-24">
                
                <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden mb-6">
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs text-slate-400 bg-slate-700 px-2 py-1 rounded">å…¬å¸³ç¸½è¦½</span>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] text-slate-400">åŒ¯ç‡</span>
                                <input type="number" step="0.001" v-model="exchangeRate" class="w-12 bg-transparent text-right text-xs text-yellow-400 font-mono border-b border-slate-600 outline-none">
                            </div>
                        </div>
                        
                        <div class="flex items-baseline gap-2">
                            <h2 class="text-3xl font-bold font-mono">â‚©{{ publicTotal.toLocaleString() }}</h2>
                            <span class="text-sm text-slate-400">ç¸½è¨ˆ</span>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
                            <div class="text-sm text-slate-300">æ¯äººæ‡‰ä»˜ (é™¤ä»¥2)</div>
                            <div class="text-xl font-bold text-green-400 font-mono">
                                â‚©{{ Math.round(publicTotal / 2).toLocaleString() }}
                                <div class="text-[10px] text-slate-500 text-right">â‰ˆ TWD {{ Math.round((publicTotal/2)*exchangeRate).toLocaleString() }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-5">
                    <div class="flex bg-white/40 p-1 rounded-xl mb-4">
                        <button @click="activeBudgetTab = 'public'" :class="`flex-1 py-1.5 rounded-lg text-xs font-bold ${activeBudgetTab==='public'?'bg-slate-800 text-white':'text-slate-600'}`">å…¬å¸³</button>
                        <button @click="activeBudgetTab = 'user1'" :class="`flex-1 py-1.5 rounded-lg text-xs font-bold ${activeBudgetTab==='user1'?'bg-slate-800 text-white':'text-slate-600'}`">{{ user1Name }}</button>
                        <button @click="activeBudgetTab = 'user2'" :class="`flex-1 py-1.5 rounded-lg text-xs font-bold ${activeBudgetTab==='user2'?'bg-slate-800 text-white':'text-slate-600'}`">{{ user2Name }}</button>
                    </div>

                    <div v-if="activeBudgetTab !== 'public'" class="mb-3 text-right">
                        <input v-if="activeBudgetTab === 'user1'" v-model="user1Name" class="text-xs bg-transparent border-b border-slate-400 w-16 text-center focus:outline-none" placeholder="åå­—">
                        <input v-if="activeBudgetTab === 'user2'" v-model="user2Name" class="text-xs bg-transparent border-b border-slate-400 w-16 text-center focus:outline-none" placeholder="åå­—">
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input v-model="newItemName" placeholder="å“é …" class="flex-1 bg-white/50 border-none rounded-lg px-3 py-2 text-sm outline-none">
                        <input v-model="newItemPrice" type="number" placeholder="â‚©" class="w-20 bg-white/50 border-none rounded-lg px-3 py-2 text-sm outline-none font-mono">
                        <button @click="addItem" class="bg-slate-800 text-white w-10 rounded-lg"><i class="ri-add-line"></i></button>
                    </div>

                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        <div v-for="(item, idx) in currentBudgetList" :key="idx" class="flex justify-between items-center p-2 border-b border-slate-200/50 last:border-0">
                            <span class="text-sm text-slate-700">{{ item.name }}</span>
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-mono font-bold text-slate-800">â‚©{{ parseInt(item.price).toLocaleString() }}</span>
                                <button @click="deleteItem(idx)" class="text-gray-400 hover:text-red-500"><i class="ri-delete-bin-line"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="flex-1 px-5 pt-4 pb-24 space-y-4">
                
                <div class="grid grid-cols-3 gap-3">
                    <a href="tel:112" class="glass-card p-3 flex flex-col items-center text-red-600 hover:bg-red-50">
                        <i class="ri-alarm-warning-fill text-xl mb-1"></i><span class="text-xs font-bold">è­¦å¯Ÿ 112</span>
                    </a>
                    <a href="tel:119" class="glass-card p-3 flex flex-col items-center text-red-600 hover:bg-red-50">
                        <i class="ri-fire-fill text-xl mb-1"></i><span class="text-xs font-bold">ç«è­¦ 119</span>
                    </a>
                    <a href="https://overseas.mofa.go.kr/kr-busan-zh/index.do" target="_blank" class="glass-card p-3 flex flex-col items-center text-blue-600 hover:bg-blue-50">
                        <i class="ri-government-fill text-xl mb-1"></i><span class="text-xs font-bold">è¾¦äº‹è™•</span>
                    </a>
                </div>

                <div class="glass-card p-4">
                    <h3 class="font-bold text-slate-800 mb-3"><i class="ri-translate-2 text-blue-500"></i> å¿…å‚™ç¿»è­¯</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <div v-for="t in translations" class="bg-white/40 p-2 rounded-lg">
                            <div class="text-[10px] text-slate-500">{{ t.zh }}</div>
                            <div class="font-bold text-slate-800">{{ t.kr }}</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-slate-800"><i class="ri-suitcase-line text-orange-500"></i> è¡Œæ</h3>
                        <div class="flex bg-white/40 rounded-lg p-0.5">
                            <button @click="activeChecklistTab='user1'" :class="`px-3 py-0.5 text-xs rounded-md ${activeChecklistTab==='user1'?'bg-white shadow text-slate-800':'text-slate-500'}`">{{ user1Name }}</button>
                            <button @click="activeChecklistTab='user2'" :class="`px-3 py-0.5 text-xs rounded-md ${activeChecklistTab==='user2'?'bg-white shadow text-slate-800':'text-slate-500'}`">{{ user2Name }}</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div v-for="(item, idx) in currentChecklist" :key="idx" @click="toggleCheck(idx)" class="flex items-center gap-2 p-1 cursor-pointer">
                            <i :class="item.done ? 'ri-checkbox-circle-fill text-orange-500' : 'ri-checkbox-blank-circle-line text-slate-300'"></i>
                            <span :class="`text-sm ${item.done ? 'text-slate-400 line-through' : 'text-slate-700'}`">{{ item.text }}</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <nav v-show="!showWelcomePage" class="fixed bottom-0 left-0 right-0 glass-nav z-50 pb-[env(safe-area-inset-bottom)]">
            <div class="grid grid-cols-5 h-16 max-w-md mx-auto items-center">
                <button @click="currentTab='home'" :class="`flex flex-col items-center ${currentTab==='home'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-home-smile-2-fill text-xl"></i><span class="text-[10px] mt-0.5">é¦–é </span>
                </button>
                <button @click="currentTab='schedule'" :class="`flex flex-col items-center ${currentTab==='schedule'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-calendar-todo-fill text-xl"></i><span class="text-[10px] mt-0.5">è¡Œç¨‹</span>
                </button>
                <button @click="currentTab='joy'" class="relative -top-4">
                    <div :class="`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transform transition-all ${currentTab==='joy' ? 'bg-gradient-to-tr from-purple-500 to-pink-500 text-white scale-110' : 'bg-white text-purple-300'}`">
                        <i class="ri-emotion-happy-line text-3xl"></i>
                    </div>
                </button>
                <button @click="currentTab='budget'" :class="`flex flex-col items-center ${currentTab==='budget'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-wallet-3-fill text-xl"></i><span class="text-[10px] mt-0.5">è¨˜å¸³</span>
                </button>
                <button @click="currentTab='info'" :class="`flex flex-col items-center ${currentTab==='info'?'text-purple-600':'text-slate-400'}`">
                    <i class="ri-apps-2-fill text-xl"></i><span class="text-[10px] mt-0.5">è³‡è¨Š</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // UI ç‹€æ…‹
                const showWelcomePage = ref(true);
                const currentTab = ref('home');
                const importCode = ref('');
                
                // æ ¸å¿ƒè³‡æ–™
                const user1Name = ref('é´¨');
                const user2Name = ref('æº«');
                const exchangeRate = ref(0.024);
                const daysLeft = ref(0);

                // å¾…è¾¦
                const prepList = ref([
                    {text:'è²·æ©Ÿç¥¨', done:false}, {text:'è¨‚ä½å®¿', done:false}, 
                    {text:'è† å›Šåˆ—è»Šé ç´„', done:false}, {text:'ESIM/ç¶²å¡', done:false}
                ]);
                const newPrepItem = ref('');

                // è¡Œç¨‹è³‡æ–™
                const activeDayIndex = ref(0);
                const itinerary = ref([
                    {day:1, date:"11/13(äº”)", title:"æŠµé”é‡œå±±", events:[{time:"14:30", title:"é‡‘æµ·æ©Ÿå ´", desc:"é ˜éŒ¢/æ­è»Š", mapQuery:"Gimhae Airport"}, {time:"18:00", title:"è¥¿é¢æ™šé¤", desc:"å‘³è´Šç‹é¹½çƒ¤è‚‰", mapQuery:"Matchandeul Wang Sogeum Gui Seomyeon"}, {time:"20:00", title:"Olive Young", desc:"è¥¿é¢æ——è‰¦åº—", mapQuery:"Olive Young Seomyeon"}]},
                    {day:2, date:"11/14(å…­)", title:"æµ·é›²å°&ç…™ç«", events:[{time:"11:30", title:"è† å›Šåˆ—è»Š", desc:"å°¾æµ¦ -> é’æ²™æµ¦", mapQuery:"Mipo Station"}, {time:"12:30", title:"é’æ²™æµ¦åˆé¤", desc:"ç§€æ•å®¶ç‚­ç«çƒ¤è²", mapQuery:"Suminene"}, {time:"19:00", title:"åœ‹éš›ç…™ç«ç¯€", desc:"å»£å®‰é‡Œæ²™ç˜/é£¯åº—", mapQuery:"Gwangalli Beach"}]},
                    {day:3, date:"11/15(æ—¥)", title:"æ…¶å·å¤åŸ", events:[{time:"11:30", title:"éŸ“æœé«”é©—", desc:"å¤§é™µè‹‘ Dorandoran", mapQuery:"Gyeongju Daereungwon"}, {time:"13:30", title:"çš‡ç†åœ˜è·¯", desc:"éŸ“å±‹å’–å•¡å»³", mapQuery:"Hwangnidan-gil"}, {time:"18:00", title:"æ±å®®èˆ‡æœˆæ± ", desc:"å¤œæ™¯æ•£æ­¥", mapQuery:"Donggung Palace and Wolji Pond"}]},
                    {day:4, date:"11/16(ä¸€)", title:"ç”˜å·èˆ‡è³¼ç‰©", events:[{time:"10:30", title:"ç”˜å·æ´æ–‡åŒ–æ‘", desc:"å°ç‹å­æ‹ç…§", mapQuery:"Gamcheon Culture Village"}, {time:"15:00", title:"æ¨‚å¤©è¶…å¸‚", desc:"å—æµ¦æ´è²·ä¼´æ‰‹ç¦®", mapQuery:"Lotte Mart Gwangbok"}]},
                    {day:5, date:"11/17(äºŒ)", title:"å¿«æ¨‚è¿”å®¶", events:[{time:"11:00", title:"å‰å¾€æ©Ÿå ´", desc:"å…ç¨…åº—è£œè²¨", mapQuery:"Gimhae Airport"}]}
                ]);

                // å¿«æ¨‚è³‡æ–™
                const activeJoyCat = ref('food');
                const joyCategories = [
                    {id:'food', name:'ç¾é£Ÿ', icon:'ri-restaurant-2-fill'}, 
                    {id:'cafe', name:'å’–å•¡', icon:'ri-cup-fill'}, 
                    {id:'shop', name:'è³¼ç‰©', icon:'ri-shopping-bag-3-fill'}, 
                    {id:'snack', name:'å°åƒ', icon:'ri-cake-3-fill'}
                ];
                const joyData = ref({
                    food: [
                        {name:'å‘³è´Šç‹é¹½çƒ¤è‚‰', desc:'è¥¿é¢ï½œå¿…åƒåšåˆ‡äº”èŠ±è‚‰', query:'Matchandeul Wang Sogeum Gui', must:true},
                        {name:'èèŸ»å®¶', desc:'å—æµ¦ï½œè¾£ç‚’ç« é­šç‰›è…¸è¦', query:'Gaemijip'},
                        {name:'Eonyang Bulgogi', desc:'æµ·é›²å°ï½œå‚³çµ±éŸ“å¼çƒ¤ç‰›è‚‰', query:'Eonyang Bulgogi Busan'}
                    ],
                    cafe: [
                        {name:'Coralani', desc:'æ©Ÿå¼µï½œéšæ¢¯æµ·æ™¯', query:'Coralani', must:true},
                        {name:'Render', desc:'æµ·é›²å°ï½œè³ªæ„Ÿé¢¨', query:'Render Cafe'}
                    ],
                    shop: [
                        {name:'Olive Young', desc:'è¥¿é¢/å—æµ¦ï½œç¾å¦è–åœ°', query:'Olive Young', must:true},
                        {name:'Gentle Monster', desc:'æ–°ä¸–ç•Œç™¾è²¨', query:'Gentle Monster Busan'}
                    ],
                    snack: [
                        {name:'å…ƒç¥–é»‘ç³–é¤…', desc:'BIFFå»£å ´', query:'Busan Hotteok'},
                        {name:'å¤ä¾†æ€é­šç³•', desc:'æµ·é›²å°', query:'Goraesa Fish Cake'}
                    ]
                });

                // è¨˜å¸³è³‡æ–™
                const activeBudgetTab = ref('public');
                const newItemName = ref('');
                const newItemPrice = ref('');
                const publicExpenses = ref([]);
                const user1Expenses = ref([]);
                const user2Expenses = ref([]);

                // ç¿»è­¯
                const translations = [
                    {zh:'ä½ å¥½', kr:'ì•ˆë…•í•˜ì„¸ìš”'}, {zh:'è¬è¬', kr:'ê°ì‚¬í•©ë‹ˆë‹¤'},
                    {zh:'å¤šå°‘éŒ¢?', kr:'ì–¼ë§ˆì˜ˆìš”?'}, {zh:'è«‹çµ¦æˆ‘é€™å€‹', kr:'ì´ê±° ì£¼ì„¸ìš”'},
                    {zh:'å»æ‰€?', kr:'í™”ì¥ì‹¤?'}
                ];

                // è¡Œæ
                const activeChecklistTab = ref('user1');
                const user1Packing = ref([{text:'è­·ç…§',done:false}, {text:'è½‰æ¥é ­',done:false}, {text:'ç‰™åˆ·',done:false}]);
                const user2Packing = ref([{text:'è­·ç…§',done:false}, {text:'é›¢å­å¤¾',done:false}, {text:'åŒ–å¦åŒ…',done:false}]);

                // è¨ˆç®—å±¬æ€§
                const currentBudgetList = computed(() => {
                    if(activeBudgetTab.value === 'public') return publicExpenses.value;
                    return activeBudgetTab.value === 'user1' ? user1Expenses.value : user2Expenses.value;
                });
                
                const publicTotal = computed(() => publicExpenses.value.reduce((s,i)=>s+Number(i.price),0));
                const currentChecklist = computed(() => activeChecklistTab.value === 'user1' ? user1Packing.value : user2Packing.value);

                // å­˜å–é‚è¼¯
                const saveData = () => {
                    const data = {
                        u1: user1Name.value, u2: user2Name.value, rate: exchangeRate.value,
                        prep: prepList.value, itin: itinerary.value,
                        pub: publicExpenses.value, u1e: user1Expenses.value, u2e: user2Expenses.value,
                        u1p: user1Packing.value, u2p: user2Packing.value
                    };
                    localStorage.setItem('busan_2026_final', JSON.stringify(data));
                };

                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('busan_2026_final');
                        if(saved) {
                            const d = JSON.parse(saved);
                            if(d.u1) user1Name.value = d.u1;
                            if(d.u2) user2Name.value = d.u2;
                            if(d.rate) exchangeRate.value = d.rate;
                            if(d.prep) prepList.value = d.prep;
                            if(d.itin) itinerary.value = d.itin;
                            if(d.pub) publicExpenses.value = d.pub;
                            if(d.u1e) user1Expenses.value = d.u1e;
                            if(d.u2e) user2Expenses.value = d.u2e;
                            if(d.u1p) user1Packing.value = d.u1p;
                            if(d.u2p) user2Packing.value = d.u2p;
                        }
                    } catch(e) {}
                };

                // æ“ä½œåŠŸèƒ½
                const addPrep = () => { if(newPrepItem.value){ prepList.value.push({text:newPrepItem.value, done:false}); newPrepItem.value=''; }};
                const deletePrep = (i) => prepList.value.splice(i,1);
                const addItem = () => { if(newItemName.value && newItemPrice.value){ currentBudgetList.value.push({name:newItemName.value, price:newItemPrice.value}); newItemName.value=''; newItemPrice.value=''; }};
                const deleteItem = (i) => currentBudgetList.value.splice(i,1);
                const toggleCheck = (i) => currentChecklist.value[i].done = !currentChecklist.value[i].done;
                
                const exportData = () => {
                    saveData();
                    const code = btoa(unescape(encodeURIComponent(JSON.stringify(localStorage.getItem('busan_2026_final')))));
                    navigator.clipboard.writeText(code).then(()=>alert("ä»£ç¢¼å·²è¤‡è£½ï¼"));
                };
                const processImport = () => {
                    try {
                        const json = decodeURIComponent(escape(atob(importCode.value)));
                        localStorage.setItem('busan_2026_final', JSON.parse(json));
                        location.reload();
                    } catch(e){ alert("ä»£ç¢¼éŒ¯èª¤"); }
                };

                const openMap = (q) => window.open(`https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(q)}`, '_blank');
                const enterApp = () => showWelcomePage.value = false;

                watch([user1Name, user2Name, exchangeRate, prepList, itinerary, publicExpenses, user1Expenses, user2Expenses, user1Packing, user2Packing], saveData, {deep:true});

                onMounted(() => {
                    loadData();
                    const diff = new Date("2026-11-13").getTime() - new Date().getTime();
                    daysLeft.value = Math.max(0, Math.floor(diff/(1000*60*60*24)));
                });

                return {
                    showWelcomePage, enterApp, currentTab, importCode, processImport, exportData,
                    user1Name, user2Name, exchangeRate, daysLeft,
                    prepList, addPrep, deletePrep, newPrepItem,
                    itinerary, activeDayIndex, openMap,
                    joyCategories, activeJoyCat, joyData,
                    activeBudgetTab, newItemName, newItemPrice, addItem, deleteItem, currentBudgetList, publicTotal,
                    translations, activeChecklistTab, currentChecklist, toggleCheck
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
